//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\build.gradle
//==========================================================

plugins {
    id 'java'
    id 'application'
    // id 'com.github.johnrengelman.shadow' version '8.1.1' // optional - not required for fatJar
    // id 'at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer' version '1.0.0' // keep commented while debugging
}

group = 'at.ac.tgm'
version = '1.0.0'

repositories {
    mavenCentral()
}

dependencies {
    implementation 'com.google.guava:guava:33.4.0-jre'          // Upgraded from 32.x
    implementation 'com.google.code.gson:gson:2.12.1'           // Upgraded/Fixed typo

    // UI - FlatLaf
    // IMPORTANT: These 3 versions MUST match exactly, or it crashes.
    implementation 'com.formdev:flatlaf:3.5.4'
    implementation 'com.formdev:flatlaf-intellij-themes:3.5.4'
    implementation 'com.formdev:flatlaf-extras:3.5.4'

    testImplementation 'org.junit.jupiter:junit-jupiter:5.10.0'
    testRuntimeOnly 'org.junit.platform:junit-platform-launcher:1.10.0'
}

java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(22)
    }
}

application {
    mainClass = 'at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.Main'
}

tasks.jar {
    manifest {
        attributes 'Main-Class': application.mainClass.toString()
    }
}

/*
 * fatJar: creates a runnable "uber" jar including runtime dependencies.
 * Run it with: .\gradlew.bat fatJar
 */
task fatJar(type: Jar) {
    archiveClassifier.set('all')                   // produces *-all.jar
    duplicatesStrategy = DuplicatesStrategy.EXCLUDE
    manifest {
        attributes 'Main-Class': application.mainClass.toString()
    }
    // include compiled classes
    from sourceSets.main.output

    // include runtime deps (unpack JARs)
    from {
        configurations.runtimeClasspath.collect { it.isDirectory() ? it : zipTree(it) }
    }
    // keep the default jar contents (like resources)
    with tasks.jar
}



//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\controller\MainController.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.controller;

import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model.TimeListener;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.spiele.SpielListener;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.view.EinstellungenListener;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.view.SpieleListener;

public interface MainController extends TimeListener, SpieleListener, EinstellungenListener, SpielListener {}


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\controller\MainControllerImpl.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.controller;

import static at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.util.Propagate.propagate;

import java.io.IOException;
import java.time.LocalDate;
import java.time.LocalTime;
import java.util.List;
import java.util.Optional;

import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model.Einstellungen;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model.GameState;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model.MainModel;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model.TimeListener;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model.woerter.Wortliste;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.spiele.Spiel;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.util.Propagate;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.view.EinstellungenListener;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.view.EinstellungsView;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.view.MainView;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.view.MessageType;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.view.SpieleListener;

/**
 * @author Benutzbiber
 * @version 1.0
 * @created 08-Dez-2025 15:09:38
 */
public class MainControllerImpl implements MainController {
	private Spiel currentSpiel;
	private MainModel mainModel;
	private MainView mainView;
	private List<Spiel> spiele;

	/**
	 * 
	 * @param spiele
	 */
	public MainControllerImpl(List<Spiel> spiele, MainModel mainModel, MainView mainView){
		this.spiele = spiele;
		this.mainModel = mainModel;
		this.mainView = mainView;

		for(Spiel s : spiele)
			s.setSpielListener(this);

		Thread.setDefaultUncaughtExceptionHandler((t, e) -> handleException(e));
		Propagate.exceptHandler = this::handleException;

		mainModel.setTimeListener(this);
		mainView.setController(this);

		String[] themes = mainView.getAvailableThemes();

		mainView.getEinstellungsView().setThemes(themes);

		propagate(() -> mainView.setTheme(mainModel.getEinstellungen().getTheme()));

		propagate(() -> mainView.getHomeView().setTipOfTheDay(mainModel.getTipOfTheDay()));

		mainModel.setTimeListener(this);
		propagate(() -> mainView.getEinstellungsView().setSchwierigkeiten(mainModel.getEinstellungen().getSchwierigkeiten()));

		propagate(() -> mainView.getSpieleView().setSpiele(spiele));

		String recentlyPlayed = propagate(() -> mainModel.getUserData().getRecentlyPlayedGame());
		if(recentlyPlayed != null) {
			Optional<Spiel> spiel = spiele.stream().filter(s -> s.getName().equals(recentlyPlayed)).findFirst();
			if(spiel.isPresent())
				mainView.getHomeView().setRecentlyPlayedSpiel(spiel.get());
		}

		updateEinstellungsView();
	}

	public void onSpielBeenden(){
		if(currentSpiel == null) return;
		currentSpiel.spielBeenden();
		currentSpiel = null;
		mainModel.setGameState(GameState.GAME_ABSENT);
		mainView.disposeSpiel();
	}

	/**
	 * 
	 * @param datum
	 * @param time
	 */
	public void onUpdateTime(LocalDate datum, LocalTime time){
		mainView.getHomeView().setDatum(datum);
		mainView.getHomeView().setUhrzeit(time);
	}

	private void updateEinstellungsView() {
		propagate(() -> {
			EinstellungsView eV = mainView.getEinstellungsView();
			Einstellungen eM = mainModel.getEinstellungen();
			eV.setAnzahlRunden(eM.getAnzahlRunden());
			eV.setSchwierigkeit(eM.getSchwierigkeit());
			eV.setTheme(eM.getTheme());
			if(!eV.getTheme().equals(eM.getTheme())) 
				mainView.setTheme(eM.getTheme());
		});
	}

	public void onEinstellungenSave()  {
		EinstellungsView eV = mainView.getEinstellungsView();
		Einstellungen eM = propagate(() -> mainModel.getEinstellungen());
		try {
			eM.setAnzahlRunden(eV.getAnzahlRunden());
			eM.setSchwierigkeit(eV.getSchwierigkeit());
			eM.setTheme(eV.getTheme());
			//if(!eM.getTheme().equals(eV.getTheme())) 
				mainView.setTheme(eM.getTheme());
			propagate(() -> eM.save());
		} catch (IllegalArgumentException e) {
			mainView.showMessage("Invalide Eingabe", e.getMessage(), MessageType.ERROR);
		}
	}

	@Override
	public void onSpielSelected(String name) {
		if(currentSpiel != null) onSpielBeenden();
		for(Spiel spiel : spiele)
			if(spiel.getName().endsWith(name)) {
				currentSpiel = spiel;
				propagate(() -> mainModel.getUserData().setRecentlyPlayedGame(name));
				mainView.getHomeView().setRecentlyPlayedSpiel(spiel);
				propagate(() -> mainModel.getUserData().save());
				mainModel.setGameState(GameState.GAME_RUNNING);
				spiel.spielStarten();
				mainView.setSpiel(spiel);
				return;
			}
		mainView.showMessage("Lade Fehler", "Spiel konnte nicht gefunden werden", MessageType.ERROR);
	}

	private void handleException(Throwable e) {
		mainView.showMessage("Internal Error", e.getMessage(), MessageType.ERROR);
		e.printStackTrace();
	}

	@Override
	public Einstellungen getEinstellungen() {
		return propagate(() -> mainModel.getEinstellungen());
	}

	@Override
	public Wortliste getWortliste() {
		return mainModel.getWortliste();
	}
}//end MainControllerImpl


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\Main.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer;

import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model.MainModelImpl;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.spiele.SpielListe;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model.MainModel;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.controller.MainControllerImpl;

import javax.swing.SwingUtilities;

import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.controller.MainController;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.view.MainView;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.view.MainViewImpl;

/**
 * @author mhbau
 * @version 1.0
 * @created 08-Dez-2025 15:09:38
 */
public class Main {
	public Main() {
		 String currentDir = System.getProperty("user.dir");
        
        // Print it
        System.out.println("Current working directory: " + currentDir);
		SwingUtilities.invokeLater(() -> {
			MainView mV = new MainViewImpl();
			MainModel mM = new MainModelImpl();
			MainController mC = new MainControllerImpl(SpielListe.SPIELE, mM, mV);
		});
	}
	/**
	 * 
	 * @param args
	 */
	public static void main(String[] args){
		new Main();
	}
}//end Main


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\model\Einstellungen.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model;

import java.io.BufferedWriter;
import java.io.FileWriter;
import java.io.IOException;
import java.nio.charset.StandardCharsets;
import java.nio.file.Files;
import java.nio.file.OpenOption;
import java.nio.file.Path;
import java.nio.file.StandardOpenOption;

import com.google.gson.Gson;
import com.google.gson.reflect.TypeToken;

import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.util.GsonIO;

/**
 * @author mhbau
 * @version 1.0
 * @created 08-Dez-2025 15:09:38
 */
public class Einstellungen {
	private int anzahlSpielrunden;
	public static final Path einstellungenPath = Path.of("settings/settings.json");
	private static final String[] schwierigkeiten = new String[]{"Leicht","Normal","Schwer", "DEMO"};
	private String schwierigkeit;
	private String theme;

	public void setTheme(String theme) {
		this.theme = theme;
	}

	/**
	 * START AT 1 BEING THE LOWEST!
	 * @param schwierigkeit
	 * @return
	 */
	public int numerifySchwierigkeit(String schwierigkeit) {
		for(int i = 0; i < schwierigkeiten.length; i++) {
			if(schwierigkeiten[i].equals(schwierigkeit))
				return i+1;
		}
		return -1;
	}

	public String[] getSchwierigkeiten() {
		return schwierigkeiten;
	}

	public int getAnzahlRunden(){
		return anzahlSpielrunden;
	}

	public String getSchwierigkeit(){
		return schwierigkeit;
	}

	public String getTheme(){
		return theme;
	}

	public void save() throws IOException{
		save(this, einstellungenPath);
	}

	/**
	 * 
	 * @param einstellungen
	 * @param path
	 */
	public static void save(Einstellungen einstellungen, Path path) throws IOException {
		GsonIO.save(einstellungen, Einstellungen.class, path);
	}

	/**
	 * 
	 * @param path
	 * @return einstellungen
	 */
	public static Einstellungen load(Path path) throws IOException {
		return GsonIO.load(path, Einstellungen.class);
	}

	/**
	 * 
	 * @param anzahlRunden
	 */
	public void setAnzahlRunden(int anzahlRunden)  {
		if(anzahlRunden < 0 || anzahlRunden > 100) 
			throw new IllegalArgumentException("Anzahl der runden darf nur im Bereich 0 - 100 sein!");
		this.anzahlSpielrunden = anzahlRunden;
	}

	/**
	 * 
	 * @param schwierigkeit
	 */
	public void setSchwierigkeit(String schwierigkeit)  {
		boolean found = false;
		for(String s : schwierigkeiten)
			if(s.equals(schwierigkeit)) found = true;
		if(!found) 
			throw new IllegalArgumentException("Schwierigkeit muss entweder 1, 2 oder 3 sein!");
		this.schwierigkeit = schwierigkeit;
	}
}//end Einstellungen


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\model\GameState.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model;


/**
 * @author mhbau
 * @version 1.0
 * @created 08-Dez-2025 15:09:38
 */
public enum GameState {
	GAME_RUNNING,
	GAME_INTERRUPTED,
	GAME_ABSENT
}


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\model\MainModel.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model;

import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model.woerter.Wortliste;

import java.io.IOException;

/**
 * @author Benutzbiber
 * @version 1.0
 * @created 08-Dez-2025 15:09:39
 */
public interface MainModel {

	public Einstellungen getEinstellungen() throws IOException;

	UserData getUserData() throws IOException;

	public GameState getGameState();

	public void setGameState(GameState g);

	public Tip getTipOfTheDay() throws IOException;

	public Wortliste getWortliste();

	public void setTimeListener(TimeListener controller);
}


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\model\MainModelImpl.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model;

import java.io.IOException;

import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model.woerter.Wortliste;

import static at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.util.Propagate.propagate;

/**
 * @author Benutzbiber
 * @version 1.0
 * @created 08-Dez-2025 15:09:39
 */
public class MainModelImpl implements MainModel {

	private GameState gameState;
	private TimeUpdateThread timer;
	private Wortliste wortliste;
	private Einstellungen einstellungen;
	private UserData userData;

	/**
	 * 
	 * @param controller
	 * @throws IOException 
	 */
	public MainModelImpl() {
		timer = new TimeUpdateThread();
		timer.start();
		wortliste = Wortliste.getInstance();
	}

	@Override
	public void setTimeListener(TimeListener controller) {
		timer.setTimeListener(controller);
	}

	public Einstellungen getEinstellungen() throws IOException {
		if(einstellungen == null) einstellungen = Einstellungen.load(Einstellungen.einstellungenPath);
		return einstellungen;
	}

	public UserData getUserData() throws IOException {
		if(userData == null) userData = UserData.load(UserData.userDataPath);
		return userData;
	}

	public GameState getGameState(){
		return gameState;
	}

	public Tip getTipOfTheDay() throws IOException {
		return Tip.getTipOfTheDay();
	}


	@Override
	public void setGameState(GameState g) {
		gameState = g;
	}


	@Override
	public Wortliste getWortliste() {
		return wortliste;
	}
}//end MainModelImpl


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\model\Statistik.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model;

import java.util.HashMap;

/**
 * @author mhbau
 * @version 1.0
 * @created 08-Dez-2025 13:58:04
 */
public class Statistik {
	private String fliesstext;
	private HashMap<String, String> statfields;
	private String title;

	/**
	 * 
	 * @param flie�text
	 * @param title
	 * @param statfields
	 */
	public Statistik(String fliesstext, String title, HashMap<String, String> statfields){
		this.fliesstext = fliesstext;
		this.title = title;
		this.statfields = statfields;
	}

	public String getFliesstext(){
		return fliesstext;
	}

	public HashMap<String, String> getStatFields(){
		return statfields;
	}

	/**
	 * 
	 * @param String
	 */
	public String getTitle(){
		return title;
	}

	/**
	 * 
	 * @param flie�text
	 */
	public void setFliessText(String fliesstext){
		this.fliesstext = fliesstext;
	}

	/**
	 * 
	 * @param newTitle
	 */
	public void setTitle(String newTitle){
		this.title = newTitle;
	}
}//end Statistik


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\model\TimeListener.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model;

import java.time.LocalDate;
import java.time.LocalTime;

/**
 * @author mhbau
 * @version 1.0
 * @created 08-Dez-2025 15:09:39
 */
public interface TimeListener {

	/**
	 * 
	 * @param date
	 * @param time
	 */
	public void onUpdateTime(LocalDate date, LocalTime time);

}


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\model\TimeUpdateThread.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model;

import java.time.LocalDate;
import java.time.LocalTime;
import java.util.concurrent.Executors;
import java.util.concurrent.ScheduledExecutorService;
import java.util.concurrent.TimeUnit;

/**
 * @author mhbau
 * @version 1.0
 * @created 08-Dez-2025 15:09:39
 */
public class TimeUpdateThread {

    public static final int UPDATE_INTERVAL_MIN = 1;
    private final ScheduledExecutorService scheduler = Executors.newSingleThreadScheduledExecutor();
    private TimeListener timerCallback;

    public void setTimeListener(TimeListener l) {
        this.timerCallback = l;
        timerCallback.onUpdateTime(LocalDate.now(), LocalTime.now());
    }

    public void start() {
        scheduler.scheduleAtFixedRate(() -> {
            if (timerCallback != null) 
                timerCallback.onUpdateTime(LocalDate.now(), LocalTime.now());
        }, 0, UPDATE_INTERVAL_MIN, TimeUnit.MINUTES);
    }

    public void stop() {
        scheduler.shutdownNow();
    }
}//end TimeUpdateThread


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\model\Tip.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model;

import java.io.IOException;
import java.nio.charset.Charset;
import java.nio.charset.StandardCharsets;
import java.nio.file.Files;
import java.nio.file.Path;
import java.time.LocalDate;
import java.util.ArrayList;
import java.util.List;

import com.google.gson.Gson;
import com.google.gson.reflect.TypeToken;

import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.util.GsonIO;

/**
 * @author Benutzbiber
 * @version 1.0
 * @created 08-Dez-2025 15:09:39
 */
public record Tip(String text, String title) {
	public static final Path tipsPath = Path.of("tips/tips.json");
	private static List<Tip> tips;

	/**
	 * 
	 * @param date
	 * @param path
	 * @throws IOException 
	 */
	public static Tip getTipOfTheDay(LocalDate date, Path path) throws IOException {
		if(tips == null) loadTips(path);
		if (tips.isEmpty()) return null;

		long days = date.toEpochDay();

		int index = (int) (days % tips.size());
		if (index < 0) index += tips.size();

		return tips.get(index);
	}

	/**
	 * 
	 * @param date
	 * @throws IOException 
	 */
	public static Tip getTipOfTheDay() throws IOException{
		return getTipOfTheDay(LocalDate.now(), tipsPath);
	}

	/**
	 * 
	 * @param tipsPath
	 * @throws IOException 
	 */
	public static void loadTips(Path path) throws IOException {
		tips = GsonIO.load(path, new TypeToken<List<Tip>>(){}.getType());
	}
}//end Tip


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\model\UserData.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model;

import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Path;

import com.google.gson.Gson;

import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.util.GsonIO;

public class UserData {
    public static final Path userDataPath = Path.of("userdata/userdata.json");

    private String recentlyPlayedGame;

    public void setRecentlyPlayedGame(String recentlyPlayedGame) {
        this.recentlyPlayedGame = recentlyPlayedGame;
    }

    public String getRecentlyPlayedGame() {
        return recentlyPlayedGame;
    }
    
    public static UserData load(Path path) throws IOException {
        return GsonIO.load(path, UserData.class);
    }

    public void save(Path path) throws IOException {
        GsonIO.save(this, UserData.class, path);
    }

    public void save() throws IOException {
        save(userDataPath);
    }
}


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\model\woerter\ImportResult.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model.woerter;

import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model.woerter.Wort;
import java.util.List;
import java.util.Map;

// Package-private reicht, da nur Importer und Wortliste es sehen müssen
record ImportResult(
        List<Wort> woerter,
        Map<Wort, Wort> elternLookup,
        List<String> warnungen
) {}


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\model\woerter\InvalidWortException.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model.woerter;

/**
 * Signalisiert, dass ein Eintrag im JSON logisch ungültig ist
 * (z.B. fehlender Text, Nomen ohne Artikel, unbekannte Wortart).
 */
public class InvalidWortException extends Exception {
    public InvalidWortException(String message) {
        super(message);
    }
}


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\model\woerter\UnavailableWortOperationException.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model.woerter;

public class UnavailableWortOperationException extends RuntimeException {
    public UnavailableWortOperationException(String message) {
        super(message);
    }
}


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\model\woerter\Wort.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model.woerter;

import java.util.List;
import java.util.Set;

/**
 * Repräsentiert ein Wort oder eine Wortform.
 *
 * @param wort          Der Text des Wortes (z.B. "Hunde").
 * @param wortart       Die Wortart (Nomen, Verb, etc.).
 * @param artikel       Der Artikel (nur bei Nomen relevant, sonst null).
 * @param tags          Liste von Eigenschaften (SINGULAR, PLURAL, GENITIV, BASIS, etc.).
 * @param variationen   Liste der abgeleiteten Formen.
 */
public record Wort(
        String wort,
        Wortart wortart,
        String artikel,
        //int laenge
        //double komplexitat -> 0-10
        Set<WortTag> tags,
        List<Wort> variationen
) {

    /**
     * Kompakter Konstruktor für Validierung und Erstellung unveränderlicher Kopien.
     */
    public Wort {
        // Set.copyOf erstellt eine unmodifizierbare Kopie.
        // Wenn 'tags' null ist, nehmen wir ein leeres Set.
        tags = (tags == null) ? Set.of() : Set.copyOf(tags);

        // List.copyOf erstellt eine unmodifizierbare Kopie.
        // Das bedeutet: Nach der Erstellung des Wortes kann niemand mehr .add() oder .remove() aufrufen.
        variationen = (variationen == null) ? List.of() : List.copyOf(variationen);
    }

    /**
     * Komplexität von 0-10;
     * @return
     */
    public double komplexitaet() {
        // Todo: Implementierung der Komplexitätsberechnung
        return 5;
    }

    public int laenge() {
        return wort.length();
    }

    public int getFall() throws UnavailableWortOperationException {
        if(tags().contains(WortTag.NOMINATIV)) {
            return 1;
        } else if(tags().contains(WortTag.GENITIV)) {
            return 2;
        } else if(tags().contains(WortTag.DATIV)) {
            return 3;
        } else if(tags().contains(WortTag.AKKUSATIV)) {
            return 4;
        }
        throw new UnavailableWortOperationException("Kein Fall für:" + wort);
    }

    public String displayWord() {
        return switch (wortart) {
            case NOMEN -> artikel() + " " + (wort.substring(0, 1).toUpperCase() + wort.substring(1).toLowerCase());
            default -> wort.toLowerCase();
        };
    }
}


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\model\woerter\Wortart.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model.woerter;

import com.google.gson.annotations.SerializedName;

public enum Wortart {
    @SerializedName("Nomen") NOMEN("Nomen"),
    @SerializedName("Verb") VERB("Verb"),
    @SerializedName("Adjektiv") ADJEKTIV("Adjektiv"),
    @SerializedName("Artikel") ARTIKEL("Artikel"),
    @SerializedName("Pronomen") PRONOMEN("Pronomen"),
    @SerializedName("Numeral") NUMERAL("Numeral"),
    @SerializedName("Adverb") ADVERB("Adverb"),
    @SerializedName("Konjunktion") KONJUNKTION("Konjunktion"),
    @SerializedName("Interjektion") INTERJEKTION("Interjektion"),
    UNKNOWN("Unbekannt");

    private final String displayName;

    Wortart(String displayName) {
        this.displayName = displayName;
    }

    public String getName() {
        return displayName;
    }
}



//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\model\woerter\WortImporter.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model.woerter;


import com.google.gson.Gson;
import com.google.gson.JsonSyntaxException;
import com.google.gson.reflect.TypeToken;

import java.io.IOException;
import java.io.Reader;
import java.lang.reflect.Type;
import java.util.*;

final class WortImporter {

    private WortImporter() {
        throw new IllegalStateException("Utility class");
    }

    // Hilfsklasse: Spiegelt GENAU die Struktur deines JSONs wider
    private static class RawWort {
        String wort;
        Wortart wortart;
        String artikel; // nur bei Nomen zwingend
        Map<String, String> singular;
        Map<String, String> plural;
        List<String> formen; // Für Verben & Adjektive
    }

    /**
     * Liest JSON ein, validiert die Einträge und gibt ein Ergebnis-Objekt zurück.
     * Fehlerhafte Einträge werden übersprungen und als Warnung gesammelt.
     */
    static ImportResult importJson(Reader reader) throws IOException {
        Gson gson = new Gson();
        Type listType = new TypeToken<List<RawWort>>(){}.getType();

        List<RawWort> rawList;
        try {
            rawList = gson.fromJson(reader, listType);
        } catch (JsonSyntaxException e) {
            throw new IOException("JSON-Format ist korrupt und konnte nicht geparst werden.", e);
        }

        List<Wort> alleWoerterFlach = new ArrayList<>();
        Map<Wort, Wort> kindZuBasisMap = new HashMap<>();
        List<String> warnungen = new ArrayList<>();

        // Falls die Datei leer war
        if (rawList == null) {
            warnungen.add("Datei war leer oder enthielt kein gültiges JSON-Array.");
            return new ImportResult(Collections.emptyList(), Collections.emptyMap(), warnungen);
        }

        for (RawWort raw : rawList) {
            // --- VALIDIERUNG START ---
            try {
                validiereRawEintrag(raw);
            } catch (InvalidWortException e) {
                String name = (raw.wort != null) ? raw.wort : "Unbekanntes Wort";
                warnungen.add("Eintrag '" + name + "' übersprungen: " + e.getMessage());
                continue; // Springt zum nächsten Wort, dieses wird ignoriert
            }
            // --- VALIDIERUNG ENDE ---

            // Schritt 1: Variationen (Kinder) erstellen
            List<Wort> kinderListe = new ArrayList<>();

            // A) Nomen Variationen (Singular/Plural Maps)
            if (raw.wortart == Wortart.NOMEN) {
                kinderListe.addAll(erstelleNomenVariationen(raw.singular, raw.wortart, WortTag.SINGULAR));
                kinderListe.addAll(erstelleNomenVariationen(raw.plural, raw.wortart, WortTag.PLURAL));
            }
            // B) Verb/Adjektiv Variationen (Formen Liste)
            else if ((raw.wortart == Wortart.VERB || raw.wortart == Wortart.ADJEKTIV) && raw.formen != null) {
                kinderListe.addAll(erstelleSonstigeVariationen(raw.formen, raw.wortart));
            }

            // Schritt 2: Basis-Wort erstellen
            Set<WortTag> basisTags = new HashSet<>();
            basisTags.add(WortTag.BASIS); // Immer Basis markieren

            // Spezifische Basis-Tags je nach Wortart
            if (raw.wortart == Wortart.NOMEN) basisTags.add(WortTag.NOMINATIV);
            if (raw.wortart == Wortart.VERB) basisTags.add(WortTag.VERB_PRAESENS);
            if (raw.wortart == Wortart.ADJEKTIV) basisTags.add(WortTag.BASIS);

            Wort basis = new Wort(
                    raw.wort,
                    raw.wortart,
                    raw.artikel,
                    basisTags,
                    kinderListe // Liste wird im Record-Konstruktor kopiert (immutable)
            );

            // Schritt 3: Alles in die flache Gesamtliste und Lookup-Map packen
            alleWoerterFlach.add(basis);
            alleWoerterFlach.addAll(kinderListe);

            for (Wort kind : kinderListe) {
                kindZuBasisMap.put(kind, basis);
            }
        }

        // Fertiges Paket zurückgeben
        return new ImportResult(alleWoerterFlach, kindZuBasisMap, warnungen);
    }

    /**
     * Prüft, ob ein Raw-Eintrag logisch korrekt ist.
     * Wirft InvalidWortException, wenn Daten fehlen oder falsch sind.
     */
    private static void validiereRawEintrag(RawWort raw) throws InvalidWortException {
        if (raw == null) {
            throw new InvalidWortException("Eintrag ist null.");
        }
        if (raw.wort == null || raw.wort.trim().isEmpty()) {
            throw new InvalidWortException("Das Feld 'wort' ist leer.");
        }
        if (raw.wortart == null) {
            throw new InvalidWortException("Wortart fehlt oder ist ungültig.");
        }
        // Nomen müssen einen Artikel haben
        if (raw.wortart == Wortart.NOMEN) {
            if (raw.artikel == null || raw.artikel.trim().isEmpty()) {
                throw new InvalidWortException("Nomen benötigt zwingend einen Artikel.");
            }
        }
    }

    // --- Helper für Nomen (Map -> Wort Objekte) ---
    private static List<Wort> erstelleNomenVariationen(Map<String, String> map, Wortart art, WortTag numerus) {
        List<Wort> ergebnis = new ArrayList<>();
        if (map == null) return ergebnis;

        for (Map.Entry<String, String> entry : map.entrySet()) {
            String rawKey = entry.getKey().toLowerCase();
            String rawValue = entry.getValue();

            // "des Hundes" -> ["des", "Hundes"]
            String[] parts = splitArtikelWort(rawValue);
            String artikel = parts[0];
            String wortText = parts[1];

            if (wortText == null || wortText.isEmpty()) continue;

            WortTag fall = parseFall(rawKey);
            Set<WortTag> tags = new HashSet<>();
            tags.add(numerus);
            if (fall != null) tags.add(fall);

            // Variation erstellen (hat selbst keine Kinder -> null oder leere Liste)
            ergebnis.add(new Wort(wortText, art, artikel, tags, null));
        }
        return ergebnis;
    }

    // --- Helper für Verben/Adjektive (List -> Wort Objekte) ---
    private static List<Wort> erstelleSonstigeVariationen(List<String> formenStrings, Wortart art) {
        List<Wort> ergebnis = new ArrayList<>();
        if (formenStrings == null) return ergebnis;

        for (int i = 0; i < formenStrings.size(); i++) {
            String rawValue = formenStrings.get(i);
            WortTag tag = null;

            // Mapping basierend auf Listen-Index
            if (art == Wortart.VERB) {
                if (i == 0) tag = WortTag.VERB_VERGANGENHEIT; // z.B. "ging"
                else if (i == 1) tag = WortTag.VERB_PARTIZIP; // z.B. "gegangen"
                else if (i == 2) tag = WortTag.VERB_PRAESENS; // z.B. "geht"
            }
            else if (art == Wortart.ADJEKTIV) {
                if (i == 0) tag = WortTag.KOMPARATIV; // z.B. "schöner"
                else if (i == 1) tag = WortTag.SUPERLATIV; // z.B. "am schönsten"
            }

            if (tag == null) continue;

            // "am schönsten" -> ["am", "schönsten"]
            String[] parts = splitArtikelWort(rawValue);
            String zusatz = parts[0];
            String wortText = parts[1];

            if (wortText == null || wortText.isEmpty()) continue;

            ergebnis.add(new Wort(wortText, art, zusatz, Set.of(tag), null));
        }
        return ergebnis;
    }

    // --- Parsing Utils ---

    private static WortTag parseFall(String key) {
        if (key.contains("1") || key.contains("nominativ")) return WortTag.NOMINATIV;
        if (key.contains("2") || key.contains("genitiv") || key.contains("genetiv")) return WortTag.GENITIV;
        if (key.contains("3") || key.contains("dativ")) return WortTag.DATIV;
        if (key.contains("4") || key.contains("akkusativ")) return WortTag.AKKUSATIV;
        return null;
    }

    private static String[] splitArtikelWort(String input) {
        if (input != null && input.contains(" ")) {
            String[] parts = input.split(" ", 2);
            // Plausibilitätscheck: Artikel/Partikel ist meist kurz (<= 4 Zeichen)
            if (parts[0].length() <= 4) {
                return parts;
            }
        }
        // Kein Artikel gefunden -> [null, "Wort"]
        return new String[]{null, input};
    }
}


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\model\woerter\Wortliste.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model.woerter;

import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model.woerter.Wort;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model.woerter.WortImporter; // Muss angepasst werden, s.u.
import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Path;
import java.util.*;

public class Wortliste {

    // 1. Die einzige Instanz (Singleton)
    private static Wortliste instance;

    // 2. Mutable Speicherstrukturen (Set verhindert Duplikate beim Nachladen)
    private final Set<Wort> woerter;
    private final Map<Wort, Wort> elternLookup;
    private final List<String> importWarnungen;

    // 3. Privater Konstruktor
    private Wortliste() {
        this.woerter = new HashSet<>();
        this.elternLookup = new HashMap<>();
        this.importWarnungen = new ArrayList<>();
    }

    // 4. Globaler Zugriffspunkt
    public static synchronized Wortliste getInstance() {
        if (instance == null) {
            instance = new Wortliste();
        }
        return instance;
    }

    // --- LADE-LOGIK ---

    /**
     * Lädt Wörter aus einer oder mehreren JSON-Dateien und fügt sie der aktuellen Liste hinzu.
     * @param pfade Ein Array von Dateipfaden oder eine einzelne Datei.
     */
    public void ladeAusDateien(String... pfade) throws IOException {
        if (pfade == null) return;

        for (String pfad : pfade) {
            // Den (unsichtbaren) Importer nutzen
            ImportResult result = WortImporter.importJson(Files.newBufferedReader(Path.of(pfad)));

            // Daten mergen (Hinzufügen zur bestehenden Liste)
            this.woerter.addAll(result.woerter());
            this.elternLookup.putAll(result.elternLookup());
            this.importWarnungen.addAll(result.warnungen());
        }
    }

    /**
     * Setzt die Liste komplett zurück (löscht alles).
     */
    public void leeren() {
        this.woerter.clear();
        this.elternLookup.clear();
        this.importWarnungen.clear();
    }

    // --- ZUGRIFFSMETHODEN ---

    public Wort[] getAlleWoerter() {
        // Konvertiert das Set zurück in ein Array für die Queries
        return woerter.toArray(new Wort[0]);
    }

    public WortQuery query() {
        return new WortQuery(this);
    }

    public Wort getBasisWort(Wort w) {
        // ... Logik wie vorher ...
        return elternLookup.getOrDefault(w, w); // Vereinfacht
    }

    public List<String> getWarnungen() {
        return Collections.unmodifiableList(importWarnungen);
    }
}


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\model\woerter\WortQuery.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model.woerter;

import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model.woerter.Wort;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model.woerter.WortTag;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model.woerter.Wortart;

import java.util.*;
import java.util.function.Predicate;

public class WortQuery {

    private final Wortliste quelle;

    // Filter-Sets
    private Set<Wortart> erlaubteWortarten = new HashSet<>();
    private Set<Wortart> verboteneWortarten = new HashSet<>();

    // Ranges
    private int minLaenge = 0;
    private int maxLaenge = Integer.MAX_VALUE;
    private int minKomplexitaet = 0;
    private int maxKomplexitaet = 10;

    private boolean nurBasis = false;

    // Interne Regel-Maps
    private Map<Wortart, Set<WortTag>> pflichtRegeln = new EnumMap<>(Wortart.class);
    private Map<Wortart, Set<WortTag>> wahlRegeln = new EnumMap<>(Wortart.class);

    private List<Predicate<Wort>> customPredicates = new ArrayList<>();

    WortQuery(Wortliste quelle) {
        this.quelle = quelle;
    }

    // =================================================================
    // 1. Nomen Shortcuts
    // (Aktiviert NOMEN, lässt andere Wortarten aber unberührt!)
    // =================================================================

    /**
     * Konfiguriert, dass Nomen zwingend im Plural stehen müssen.
     * <br><b>Wichtig:</b> Fügt NOMEN zu den erlaubten Wortarten hinzu.
     * Andere erlaubte Wortarten (z.B. Verben) bleiben davon unberührt und werden weiterhin geladen.
     */
    public WortQuery nomenImPlural() {
        mitWortart(Wortart.NOMEN);
        return mussHaben(Wortart.NOMEN, WortTag.PLURAL);
    }

    /**
     * Konfiguriert, dass Nomen zwingend im Singular stehen müssen.
     * <br><b>Wichtig:</b> Fügt NOMEN zu den erlaubten Wortarten hinzu.
     */
    public WortQuery nomenImSingular() {
        mitWortart(Wortart.NOMEN);
        return mussHaben(Wortart.NOMEN, WortTag.SINGULAR);
    }

    /**
     * Schränkt Nomen auf bestimmte Fälle ein.
     * Bsp: nomenImFall(WortTag.NOMINATIV) -> Nur 1. Fall.
     */
    public WortQuery nomenImFall(WortTag... faelle) {
        mitWortart(Wortart.NOMEN);
        if (faelle.length == 1) {
            return mussHaben(Wortart.NOMEN, faelle[0]);
        } else {
            return einerVon(Wortart.NOMEN, faelle);
        }
    }

    // =================================================================
    // 2. Verb Shortcuts
    // (Aktiviert VERB, lässt andere Wortarten unberührt!)
    // =================================================================

    /**
     * Erlaubt Verben nur im Präsens (Gegenwart).
     * Bsp: "geht", "läuft".
     */
    public WortQuery verbImPraesens() {
        mitWortart(Wortart.VERB);
        return mussHaben(Wortart.VERB, WortTag.VERB_PRAESENS);
    }

    /**
     * Erlaubt Verben nur in der Vergangenheit (Präteritum).
     * Bsp: "ging", "lief".
     */
    public WortQuery verbInVergangenheit() {
        mitWortart(Wortart.VERB);
        return mussHaben(Wortart.VERB, WortTag.VERB_VERGANGENHEIT);
    }

    /**
     * Erlaubt Verben nur als Partizip (oft für Perfekt genutzt).
     * Bsp: "gegangen", "gelaufen".
     */
    public WortQuery verbInPartizip() {
        mitWortart(Wortart.VERB);
        return mussHaben(Wortart.VERB, WortTag.VERB_PARTIZIP);
    }

    // =================================================================
    // 3. Adjektiv Shortcuts
    // (Aktiviert ADJEKTIV, lässt andere Wortarten unberührt!)
    // =================================================================

    /**
     * Erlaubt Adjektive nur in der Grundform (Positiv).
     * Bsp: "schön", "schnell".
     */
    public WortQuery adjektivPositiv() {
        mitWortart(Wortart.ADJEKTIV);
        // Da Basis-Adjektive meist keine speziellen Tags haben außer BASIS (oder gar keinen Tag im JSON),
        // filtern wir hier am besten auf "Kein Komparativ und kein Superlativ".
        // Oder explizit auf BASIS, wenn dein Importer das setzt.
        return mussHaben(Wortart.ADJEKTIV, WortTag.BASIS);
    }

    /**
     * Erlaubt Adjektive nur im Komparativ (1. Steigerung).
     * Bsp: "schöner", "schneller".
     */
    public WortQuery adjektivKomparativ() {
        mitWortart(Wortart.ADJEKTIV);
        return mussHaben(Wortart.ADJEKTIV, WortTag.KOMPARATIV);
    }

    /**
     * Erlaubt Adjektive nur im Superlativ (höchste Steigerung).
     * Bsp: "am schönsten", "am schnellsten".
     */
    public WortQuery adjektivSuperlativ() {
        mitWortart(Wortart.ADJEKTIV);
        return mussHaben(Wortart.ADJEKTIV, WortTag.SUPERLATIV);
    }

    /**
     * Erlaubt Adjektive in jeder gesteigerten Form (Komparativ ODER Superlativ).
     */
    public WortQuery adjektivGesteigert() {
        mitWortart(Wortart.ADJEKTIV);
        return einerVon(Wortart.ADJEKTIV, WortTag.KOMPARATIV, WortTag.SUPERLATIV);
    }

    // =================================================================
    // 4. Basis Konfiguration & Ausführung
    // =================================================================

    public WortQuery nurBasis() {
        this.nurBasis = true;
        return this;
    }

    /**
     * Fügt Wortarten zur Liste der erlaubten Arten hinzu.
     * Dies ist ADDITIV. Bereits erlaubte Arten bleiben bestehen.
     */
    public WortQuery mitWortart(Wortart... arten) {
        Collections.addAll(erlaubteWortarten, arten);
        return this;
    }

    public WortQuery ohneWortart(Wortart... arten) {
        Collections.addAll(verboteneWortarten, arten);
        return this;
    }

    public WortQuery mitLaenge(int min, int max) {
        this.minLaenge = min;
        this.maxLaenge = max;
        return this;
    }

    public WortQuery mitKomplexitaet(int min, int max) {
        this.minKomplexitaet = min;
        this.maxKomplexitaet = max;
        return this;
    }

    public WortQuery check(Predicate<Wort> predicate) {
        this.customPredicates.add(predicate);
        return this;
    }

    // Private Helper für die Shortcuts
    private WortQuery mussHaben(Wortart art, WortTag... tags) {
        pflichtRegeln.computeIfAbsent(art, k -> new HashSet<>()).addAll(Arrays.asList(tags));
        return this;
    }

    private WortQuery einerVon(Wortart art, WortTag... tags) {
        wahlRegeln.computeIfAbsent(art, k -> new HashSet<>()).addAll(Arrays.asList(tags));
        return this;
    }

    public Wort[] excecute () {
        return Arrays.stream(quelle.getAlleWoerter())
                .filter(w -> !nurBasis || w.tags().contains(WortTag.BASIS))
                .filter(this::checkWortart)
                .filter(w -> w.laenge() >= minLaenge && w.laenge() <= maxLaenge)
                .filter(w -> w.komplexitaet() >= minKomplexitaet && w.komplexitaet() <= maxKomplexitaet)
                .filter(this::checkTags)
                .filter(w -> customPredicates.stream().allMatch(p -> p.test(w)))
                .toArray(Wort[]::new);
    }

    private boolean checkWortart(Wort w) {
        if (verboteneWortarten.contains(w.wortart())) return false;
        // Wenn allowlist leer ist, ist ALLES erlaubt. Sonst nur was drin steht.
        return erlaubteWortarten.isEmpty() || erlaubteWortarten.contains(w.wortart());
    }

    private boolean checkTags(Wort w) {
        Wortart art = w.wortart();
        Set<WortTag> currentTags = w.tags();

        if (pflichtRegeln.containsKey(art)) {
            if (!currentTags.containsAll(pflichtRegeln.get(art))) return false;
        }

        if (wahlRegeln.containsKey(art)) {
            Set<WortTag> optionen = wahlRegeln.get(art);
            if (Collections.disjoint(currentTags, optionen)) return false;
        }
        return true;
    }
}


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\model\woerter\WortTag.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model.woerter;

// NEU: Tags zum Filtern der spezifischen Formen
public enum WortTag {
    BASIS,          // Die Grundform (z.B. "Hund")

    // Fälle
    NOMINATIV, GENITIV, DATIV, AKKUSATIV,

    // Numerus
    SINGULAR, PLURAL,

    // Steigerung (Adjektive)
    POSITIV, KOMPARATIV, SUPERLATIV,

    // Verbformen
    VERB_GEGENWART,VERB_VERGANGENHEIT, VERB_PARTIZIP, VERB_PRAESENS;

}


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\spiele\artikeljaeger\ArtikeljaegerController.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.spiele.artikeljaeger;

import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model.woerter.Wortliste;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.spiele.SpielController;

/**
 * @author Benutzbiber
 * @version 1.0
 * @created 08-Dez-2025 15:09:37
 */
public class ArtikeljaegerController extends SpielController<ArtikeljaegerModel, ArtikeljaegerController, ArtikeljaegerView> {

	public ArtikeljaegerController(){
		model = new ArtikeljaegerModel();
		view = new ArtikeljaegerView(this);
	}

	@Override
	public void spielBeenden() {
		super.spielBeenden();
	}

	public void spielStarten(){
		
	}
}//end ArtikeljaegerController


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\spiele\artikeljaeger\ArtikeljaegerModel.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.spiele.artikeljaeger;

import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model.woerter.WortQuery;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model.woerter.Wortliste;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.spiele.LinearSpielModel;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.spiele.SpielListener;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model.Statistik;

/**
 * @author Benutzbiber
 * @version 1.0
 * @created 08-Dez-2025 15:09:37
 */
public class ArtikeljaegerModel extends LinearSpielModel {

	public String getSpielDescription(){
		return "Teste dein Wissen über die richtigen Artikel! In Artikeljäger bekommst du ein Wort angezeigt und musst schnell den passenden Artikel auswählen – Der, Die oder Das – indem du auf die richtigen Buttons klickst.\n" + //
						"\n" + //
						"Je schneller und genauer du die Artikel auswählst, desto mehr Punkte bekommst du. Das Spiel trainiert spielerisch dein Gespür für die deutsche Grammatik und hilft dir, die Artikel von Substantiven sicher zu erkennen.";
	}

	public String getSpielName(){
		return "Artikeljaeger";
	}

	public Statistik getStatistik(){
		return super.getStatistik();
	}

	public boolean hasNewRound(){
		return false;
	}

	

	public void spielStarten(SpielListener l){

	}
}//end Artikelj�gerModel


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\spiele\artikeljaeger\ArtikeljaegerView.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.spiele.artikeljaeger;

import java.io.InputStream;

import javax.swing.JPanel;

import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.spiele.SpielView;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.spiele.SwingSpielView;

/**
 * @author Benutzbiber
 * @version 1.0
 * @created 08-Dez-2025 15:09:37
 */
public class ArtikeljaegerView extends SwingSpielView<ArtikeljaegerController, ArtikeljaegerView> {
	

	public ArtikeljaegerView(ArtikeljaegerController c){
		super(c);
	}
}//end ArtikeljaegerView


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\spiele\fallDerWoerter\FallDerWoerterController.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.spiele.fallDerWoerter;

import javax.swing.Timer;

import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model.woerter.Wortliste;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.spiele.SpielController;

import java.awt.event.ActionEvent;

public class FallDerWoerterController extends SpielController<FallDerWoerterModel, FallDerWoerterController, FallDerWoerterView> {

    private Timer gameLoop;

    public FallDerWoerterController(){
        model = new FallDerWoerterModel();
        view = new FallDerWoerterView(this);
        
        // Game Loop (approx 60 FPS)
        gameLoop = new Timer(16, (ActionEvent e) -> {
            model.update();
            view.repaintGame();
        });
    }

    @Override
    public void spielStarten() {
        model.spielStarten(spielListener);
        gameLoop.start();
        view.requestFocus(); // Important for KeyListener
    }

    @Override
    public void spielBeenden() {
        gameLoop.stop();
        model.stopGame();
        super.spielBeenden();
    }
    
    public void moveLeft() {
        model.moveLeft();
    }
    
    public void moveRight() {
        model.moveRight();
    }

	public void setMovingLeft(boolean moving) {
        model.setMovingLeft(moving);
    }
    
    public void setMovingRight(boolean moving) {
        model.setMovingRight(moving);
    }
    
    public FallDerWoerterModel getModel() {
        return model;
    }
}


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\spiele\fallDerWoerter\FallDerWoerterModel.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.spiele.fallDerWoerter;

import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.spiele.LinearSpielModel;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.spiele.SpielListener;

import java.util.Random;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model.woerter.*;


public class FallDerWoerterModel extends LinearSpielModel {

    public static final int WIDTH = 600;
    public static final int HEIGHT = 400;
    private static final int SPAWN_Y = 50;
    private double baseSpeed;
	private double speed;
	private double baseLateralSpeed;
	private double lateralSpeed;

	private boolean movingLeft = false;
    private boolean movingRight = false;

    private Wort currentWord;
    private double currentX = 300;
    private double currentY = SPAWN_Y;
    
    public static final Wortart[] buckets = {
        Wortart.NOMEN, 
        Wortart.VERB, 
        Wortart.ADJEKTIV, 
        Wortart.ARTIKEL,
		Wortart.PRONOMEN,
		Wortart.KONJUNKTION,
		Wortart.INTERJEKTION
    };

    private final WortQuery query = wortListe.query().mitWortart(buckets).mitLaenge(1, 1);

    private Feedback lastFeedback;
    private boolean gameRunning = false;
    private Random rand = new Random();

    @Override
    public void spielStarten(SpielListener l) {
		super.spielStarten(l);
        this.gameRunning = true;

		this.movingLeft = false;
        this.movingRight = false;

		baseSpeed = 2.0;
		baseLateralSpeed = 8.0;
		speed = baseSpeed;
		lateralSpeed = baseLateralSpeed;

		lastFeedback = new Feedback("Steuerung mit Tasten A/D oder ←/→", FeedbackType.PRAISE);

		boolean custom = false;

		double multiplier = 0.0;
        switch (einstellungen.numerifySchwierigkeit(einstellungen.getSchwierigkeit())) {
            /*
             *@Marius ich hab dein fuckass switch mit 3 inlined anweisungen und breaks zu einem advanced switch gemacht
             */
            case 1 -> multiplier = 0.6;
            case 2 -> multiplier = 1.5;
            case 3 -> multiplier = 2.0;
			case 4 -> {
                custom = true;
                baseSpeed = 1; baseLateralSpeed = 7.0;
            }
            default -> multiplier = 1.0;
        }

		if(!custom) {
			this.baseSpeed = baseSpeed * multiplier;
			this.baseLateralSpeed = baseLateralSpeed * multiplier;
		}
        spawnNextWord();
    }

	public void setMovingLeft(boolean moving) { this.movingLeft = moving; }
    public void setMovingRight(boolean moving) { this.movingRight = moving; }

    public void stopGame() {
        this.gameRunning = false;
    }

    private void spawnNextWord() {
        currentWord = query.excecute()[1];
        
        currentX = WIDTH / 2.0;
        currentY = SPAWN_Y;
        
        speed = baseSpeed + Math.min(6.0, (streak * 0.1));
		lateralSpeed = baseLateralSpeed + Math.min(6.0, (streak * 0.1)) / 2.0;
    }


    public void update() {
        if (!gameRunning || currentWord == null) return;

        currentY += speed;

        if (movingLeft) {
            currentX -= lateralSpeed;
            if (currentX < 20) currentX = 20;
        }
        if (movingRight) {
            currentX += lateralSpeed;
            if (currentX > WIDTH - 20) currentX = WIDTH - 20;
        }

        if (currentY >= HEIGHT - 20) {
            checkBucketCollision();
        }
    }

    public void moveLeft() {
        if (currentX > 20) currentX -= 15;
    }

    public void moveRight() {
        if (currentX < WIDTH - 20) currentX += 15;
    }

    private void checkBucketCollision() {
        gesamtAnzahl++;
        
        int count = buckets.length;
        int bucketWidth = WIDTH / count;
        
        int bucketIndex = (int) (currentX / bucketWidth);
        
        if (bucketIndex < 0) bucketIndex = 0;
        if (bucketIndex >= count) bucketIndex = count - 1;

        Wortart hitCategory = buckets[bucketIndex];

        if (currentWord.wortart() == hitCategory) {
            streak++;
            if(streak > highestStreak)
                highestStreak = streak;
            lastFeedback = getRandomPraise();
        } else {
            streak = 0;
            fehlerAnzahl++;
            lastFeedback = getRandomScolding();
        }

        spawnNextWord();
    }

    private Feedback getRandomPraise() {
        String[] msgs = {"Fantastisch!", "Super!", "Weiter so!", "Genial!", "Korrekt!"};
        return new Feedback(msgs[rand.nextInt(msgs.length)], FeedbackType.PRAISE);
    }

    private Feedback getRandomScolding() {
        String[] msgs = {"Fast!", "Bleib dran!", "Leider nein", "Versuch's nochmal"};
        return new Feedback(msgs[rand.nextInt(msgs.length)], FeedbackType.SCOLD);
    }

	static enum FeedbackType {PRAISE,SCOLD}

	static record Feedback(String message, FeedbackType type) {}

    public double getX() { return currentX; }
    public double getY() { return currentY; }
    public String getWordText() { return currentWord != null ? currentWord.displayWord() : ""; }
    public Feedback getFeedback() { return lastFeedback; }
    public int getStreak() { return streak; }

    @Override
    public String getSpielDescription() {
        return "Teste dein Wissen über die Wortarten! In Fall der Wörter fallen Wörter vom oberen Bildschirmrand, und deine Aufgabe ist es, sie in das richtige „Wortarten-Loch“ zu steuern – zum Beispiel „laufen“ in das Loch für Verb oder „Hund“ in das Loch für Nomen. Je schneller und genauer du die Wörter richtig einsortierst, desto mehr Punkte bekommst du. Das Spiel hilft dir, die verschiedenen Wortarten zu erkennen und dein grammatisches Verständnis zu trainieren.";
    }

    @Override
    public String getSpielName() {
        return "Fall der Wörter";
    }

    @Override
    public boolean hasNewRound() {
        return true;
    }
}


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\spiele\fallDerWoerter\FallDerWoerterView.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.spiele.fallDerWoerter;

import java.awt.BasicStroke;
import java.awt.Color;
import java.awt.Font;
import java.awt.FontMetrics;
import java.awt.Graphics;
import java.awt.Graphics2D;
import java.awt.RenderingHints;
import java.awt.event.ActionEvent;
import java.awt.event.KeyAdapter;
import java.awt.event.KeyEvent;

import javax.swing.AbstractAction;
import javax.swing.ActionMap;
import javax.swing.InputMap;
import javax.swing.JPanel;
import javax.swing.KeyStroke;
import javax.swing.Timer;
import javax.swing.UIManager;

import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.spiele.SwingSpielView;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.spiele.fallDerWoerter.FallDerWoerterModel.Feedback;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.spiele.fallDerWoerter.FallDerWoerterModel.FeedbackType;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model.woerter.Wortart;
import com.formdev.flatlaf.FlatClientProperties;
import com.formdev.flatlaf.util.UIScale;

public class FallDerWoerterView extends SwingSpielView<FallDerWoerterController, FallDerWoerterView> {

    private GamePanel gamePanel;
    private FallDerWoerterModel model;

    public FallDerWoerterView(FallDerWoerterController c) {
        super(c);
        this.model = c.getModel();
        
        gamePanel = new GamePanel();
        mainPanel.setFocusable(true);
        gamePanel.requestFocusInWindow();
        
        InputMap im = gamePanel.getInputMap(JPanel.WHEN_IN_FOCUSED_WINDOW);
        
        ActionMap am = gamePanel.getActionMap();

        im.put(KeyStroke.getKeyStroke(KeyEvent.VK_LEFT, 0, false), "startLeft");
        im.put(KeyStroke.getKeyStroke(KeyEvent.VK_A, 0, false), "startLeft");
        
        im.put(KeyStroke.getKeyStroke(KeyEvent.VK_LEFT, 0, true), "stopLeft");
        im.put(KeyStroke.getKeyStroke(KeyEvent.VK_A, 0, true), "stopLeft");
        
        am.put("startLeft", new AbstractAction() {
            @Override
            public void actionPerformed(ActionEvent e) { c.setMovingLeft(true); }
        });
        am.put("stopLeft", new AbstractAction() {
            @Override
            public void actionPerformed(ActionEvent e) { c.setMovingLeft(false); }
        });

        im.put(KeyStroke.getKeyStroke(KeyEvent.VK_RIGHT, 0, false), "startRight");
        im.put(KeyStroke.getKeyStroke(KeyEvent.VK_D, 0, false), "startRight");
        
        im.put(KeyStroke.getKeyStroke(KeyEvent.VK_RIGHT, 0, true), "stopRight");
        im.put(KeyStroke.getKeyStroke(KeyEvent.VK_D, 0, true), "stopRight");

        am.put("startRight", new AbstractAction() {
            @Override
            public void actionPerformed(ActionEvent e) { c.setMovingRight(true); }
        });
        am.put("stopRight", new AbstractAction() {
            @Override
            public void actionPerformed(ActionEvent e) { c.setMovingRight(false); }
        });

        mainPanel.setLayout(new java.awt.BorderLayout());
        mainPanel.add(gamePanel, java.awt.BorderLayout.CENTER);
    }
    
    public void requestFocus() {
        gamePanel.requestFocusInWindow();
    }
    
    public void repaintGame() {
        gamePanel.repaint();
    }

    private class GamePanel extends JPanel {
        
        public GamePanel() {
            setBackground(UIManager.getColor("Panel.background"));
        }

        @Override
        protected void paintComponent(Graphics g) {
            super.paintComponent(g);
            Graphics2D g2 = (Graphics2D) g;
            g2.setRenderingHint(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_ON);

            int w = getWidth();
            int h = getHeight();

            int bucketHeight = 80;
            int bucketY = h - bucketHeight;
            
            int count = model.buckets.length;
            int bucketW = w / count;

            for (int i = 0; i < count; i++) {
                Wortart type = model.buckets[i];
                int x = i * bucketW;
                
                // 1. Determine Bucket Background Color
                Color bucketColor;
                if (i % 2 == 0) {
                    bucketColor = UIManager.getColor("Button.background");
                } else {
                    // Use a slightly different shade for alternating buckets
                    // Instead of "borderColor", we darken or lighten the button background slightly
                    // to ensure it looks good but distinct.
                    Color btnBg = UIManager.getColor("Button.background");
                    bucketColor = isDark(btnBg) ? btnBg.brighter() : btnBg.darker();
                }
                
                // 2. Fill Bucket
                g2.setColor(bucketColor);
                g2.fillRect(x, bucketY, bucketW, bucketHeight);
                
                // 3. Draw Border
                g2.setColor(UIManager.getColor("Component.borderColor")); // Better than Color.GRAY
                g2.drawRect(x, bucketY, bucketW, bucketHeight);
                
                // 4. Calculate Text Color dynamically (FIX FOR READABILITY)
                g2.setColor(getReadableTextColor(bucketColor));
                
                int fontSize = count > 5 ? 12 : 14; 
                g2.setFont(new Font("SansSerif", Font.BOLD, fontSize));
                drawCenteredString(g2, type.getName(), x + bucketW/2, bucketY + bucketHeight/2);
            }

            // --- Draw Word ---
            double wordXRatio = model.getX() / 600.0;
            double wordYRatio = model.getY() / 400.0;
            
            int screenX = (int) (wordXRatio * w);
            int screenY = (int) (wordYRatio * (h - bucketHeight));

            String wordText = model.getWordText();
            g2.setFont(new Font("SansSerif", Font.BOLD, 24));
            FontMetrics fm = g2.getFontMetrics();
            int txtW = fm.stringWidth(wordText);
            
            // Draw Word Bubble
            g2.setColor(UIManager.getColor("Component.accentColor"));
            g2.fillRoundRect(screenX - txtW/2 - 10, screenY - 25, txtW + 20, 40, 20, 20);
            
            // Draw Word Text (White text on Accent color is usually safe in FlatLaf)
            g2.setColor(Color.WHITE); 
            g2.drawString(wordText, screenX - txtW/2, screenY);

            // --- Draw HUD ---
            g2.setColor(UIManager.getColor("Label.foreground"));
            g2.setFont(new Font("SansSerif", Font.PLAIN, 18));
            g2.drawString("Streak: " + model.getStreak(), 20, 30);
            
            Feedback feedback = model.getFeedback();
            if (feedback != null && !feedback.message().isEmpty()) {
                g2.setColor(feedback.type() == FeedbackType.PRAISE ? new Color(0, 150, 0) : Color.RED);
                drawCenteredString(g2, feedback.message(), w/2, 50);
            }
        }
        
        /**
         * Calculates whether black or white text is more readable on the given background.
         */
        private Color getReadableTextColor(Color background) {
            // Calculate luminance (perceived brightness)
            double luminance = (0.299 * background.getRed() + 
                                0.587 * background.getGreen() + 
                                0.114 * background.getBlue()) / 255;

            // If bright > 0.5, use Black text. If dark < 0.5, use White text.
            return luminance > 0.5 ? Color.BLACK : Color.WHITE;
        }

        private boolean isDark(Color c) {
            double luminance = (0.299 * c.getRed() + 0.587 * c.getGreen() + 0.114 * c.getBlue()) / 255;
            return luminance < 0.5;
        }

        private void drawCenteredString(Graphics2D g2, String text, int x, int y) {
            FontMetrics fm = g2.getFontMetrics();
            int len = fm.stringWidth(text);
            g2.drawString(text, x - len / 2, y + fm.getAscent() / 2 - 5);
        }
    }
}


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\spiele\fehlerfuchs\FehlerfuchsController.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.spiele.fehlerfuchs;

import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model.woerter.Wortliste;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.spiele.SpielController;

/**
 * @author Benutzbiber
 * @version 1.0
 * @created 08-Dez-2025 15:09:38
 */
public class FehlerfuchsController extends SpielController<FehlerfuchsModel, FehlerfuchsController, FehlerfuchsView> {

	public FehlerfuchsController(){
		model = new FehlerfuchsModel();
		view = new FehlerfuchsView(this);
	}

	@Override
	public void spielBeenden() {
		super.spielBeenden();
	}

	@Override
	public void spielStarten() {
		
	}
}//end FehlerfuchsController


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\spiele\fehlerfuchs\FehlerfuchsModel.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.spiele.fehlerfuchs;

import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model.woerter.WortQuery;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model.woerter.Wortliste;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.spiele.LinearSpielModel;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.spiele.SpielListener;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model.Statistik;

/**
 * @author Benutzbiber
 * @version 1.0
 * @created 08-Dez-2025 15:09:38
 */
public class FehlerfuchsModel extends LinearSpielModel {

	public String getSpielDescription(){
        System.out.println("biber"); //#todo remove
        return "Stelle deine Rechtschreibkenntnisse auf die Probe! In Fehlerfuchs bekommst du Wörter oder Sätze angezeigt, in denen sich kleine Rechtschreibfehler eingeschlichen haben. Deine Aufgabe ist es, diese Fehler zu erkennen und zu korrigieren – zum Beispiel „Doschen“ in „Duschen“.";
	}

	public String getSpielName(){
		return "Fehlerfuchs";
	}

	public Statistik getStatistik(){
		return super.getStatistik();
	}

	public boolean hasNewRound(){
		return false;
	}

	public void spielStarten(SpielListener l){

	}
}//end FehlerfuchsModel


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\spiele\fehlerfuchs\FehlerfuchsView.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.spiele.fehlerfuchs;

import java.io.InputStream;

import javax.swing.JPanel;

import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.spiele.SpielView;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.spiele.SwingSpielView;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.spiele.artikeljaeger.ArtikeljaegerController;

/**
 * @author Benutzbiber
 * @version 1.0
 * @created 08-Dez-2025 15:09:38
 */
public class FehlerfuchsView extends SwingSpielView<FehlerfuchsController, FehlerfuchsView> {

	public FehlerfuchsView(FehlerfuchsController c){
		super(c);
	}
}//end FehlerfuchsView


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\spiele\LinearSpielModel.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.spiele;

import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model.Statistik;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model.woerter.WortQuery;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model.woerter.Wortliste;

/**
 * @author mhbau
 * @version 1.0
 * @created 08-Dez-2025 15:09:38
 */
public abstract class LinearSpielModel extends SpielModel {

	protected int fehlerAnzahl = 0;
	protected int gesamtAnzahl = 0;
	protected int highestStreak = 0;
	protected int streak = 0;

	protected WortQuery linearQuery = wortListe.query().mitLaenge(1, 1);

    @Override
	public Statistik getStatistik() 
	{
		Statistik s = super.getStatistik();
		if(gesamtAnzahl!=0) {
			double quote = ((double)fehlerAnzahl / (double)gesamtAnzahl) * 100;

			s.getStatFields().put("Anzahl der gespielten Runden", String.valueOf(gesamtAnzahl));
			s.getStatFields().put("Fehlerquote", String.format("%.1f", quote) + " %");
			s.getStatFields().put("Höchster Streak", String.valueOf(highestStreak) + " 🔥");

			String msg;

			if (quote == 0) {
				msg = "Perfekt! Du hast keinen Fehler gemacht. Weiter so!";
			} else if (quote <= 10) {
				msg = "Sehr gut! Nur wenige Fehler.";
			} else if (quote <= 25) {
				msg = "Gut, aber es gibt noch Raum für Verbesserung.";
			} else if (quote <= 50) {
				msg = "Es gibt einige Fehler, übe noch ein bisschen.";
			} else {
				msg = "Viel zu viele Fehler. Konzentriere dich und übe regelmäßig!";
			}

			s.setFliessText(msg);
		}
		return s;
	}
}//end LinearSpielModel


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\spiele\Spiel.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.spiele;

import java.io.IOException;
import java.io.InputStream;

import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.view.SpielEngineView;

/**
 * @author Benutzbiber
 * @version 1.0
 * @created 08-Dez-2025 15:09:39
 */
public interface Spiel {

	public String getDescription();

	public InputStream getIcon() throws IOException;

	public String getName();

	void setSpielListener(SpielListener l);

	public SpielEngineView newSpielEngineView();

	public void spielBeenden();

	public void spielStarten();
}


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\spiele\SpielController.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.spiele;

import java.io.IOException;
import java.io.InputStream;

import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model.woerter.Wortliste;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.view.SpielEngineView;

/**
 * @author Benutzbiber
 * @version 1.0
 * @created 08-Dez-2025 15:09:39
 */
public abstract class SpielController<
        M extends SpielModel,
        C extends SpielController<M, C, V>,
        V extends SpielView<C, V>
> implements Spiel {

	protected M model;
	protected V view;
	protected SpielListener spielListener;

	public String getDescription(){
		return model.getSpielDescription();
	}

	public InputStream getIcon() throws IOException{
		return view.loadIcon();
	}

	public String getName(){
		return model.getSpielName();
	}

	public SpielEngineView newSpielEngineView(){
		return view;
	}

	public void spielBeenden(){
		view.showStatistik(model.getStatistik());
	}

	@Override
	public void setSpielListener(SpielListener l) {
		this.spielListener = l;
	}

	public abstract void spielStarten();
}//end SpielController


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\spiele\SpielListe.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.spiele;

import java.util.List;

import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.spiele.artikeljaeger.ArtikeljaegerController;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.spiele.fallDerWoerter.FallDerWoerterController;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.spiele.fehlerfuchs.FehlerfuchsController;

public interface SpielListe {
    List<Spiel> SPIELE = List.of(
        new FehlerfuchsController(),
        new ArtikeljaegerController(),
        new FallDerWoerterController()
    );
}


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\spiele\SpielListener.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.spiele;

import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model.Einstellungen;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model.woerter.Wortliste;

public interface SpielListener {
    void onSpielBeenden();
    Einstellungen getEinstellungen();
    Wortliste getWortliste();
}


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\spiele\SpielModel.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.spiele;

import java.util.*;

import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model.Einstellungen;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model.Statistik;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model.woerter.Wort;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model.woerter.WortQuery;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model.woerter.Wortliste;

/**
 * @author Benutzbiber
 * @version 1.0
 * @created 08-Dez-2025 15:09:39
 */
public abstract class SpielModel {
    protected Wortliste wortListe;
	protected Einstellungen einstellungen;

	public abstract String getSpielDescription();

	public abstract String getSpielName();

	public Statistik getStatistik() {
        HashMap<String, String> fields = new HashMap<>();
		if(einstellungen != null)
			fields.put("Schwierigkeit", einstellungen.getSchwierigkeit());
        return new Statistik(getSpielDescription(), getSpielName() + " - Statistik", fields);
	}

	public abstract boolean hasNewRound();

	public void spielStarten(SpielListener l) {
		einstellungen = l.getEinstellungen();
        wortListe = l.getWortliste();
        
	}
}//end SpielModel


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\spiele\SpielView.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.spiele;

import java.io.IOException;
import java.io.InputStream;
import java.nio.file.Files;
import java.nio.file.Path;

import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model.Statistik;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.view.SpielEngineView;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.view.StatistikDialog;

/**
 * @author Benutzbiber
 * @version 1.0
 * @created 08-Dez-2025 13:58:04
 */
public abstract class SpielView<
        C extends SpielController<?, C, V>,
        V extends SpielView<C, V>
> implements SpielEngineView {

	public static final String iconsPath = "/icons";
	protected C spielController;

	/**
	 * 
	 * @param spielController
	 */
	public SpielView(C spielController){
		this.spielController = spielController;
	}

	protected String getIconResource() {
		return iconsPath + "/" + spielController.getName()+".png";
	}

	/**
	 * 
	 * @param path
	 * @throws IOException 
	 */
	public InputStream loadIcon() throws IOException {
		InputStream in = spielController.getClass().getResourceAsStream(getIconResource());

		if (in == null) {
			throw new IOException("Resource not found: " + getIconResource());
		}
		return in;
	}

	public void neuesSpiel(){
		
	}

	/**
	 * 
	 * @param statistik
	 */
	public void showStatistik(Statistik statistik){
		StatistikDialog sDialog = new StatistikDialog(statistik);
		sDialog.setVisible(true);
	}
}//end SpielView


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\spiele\SwingSpielView.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.spiele;

import javax.swing.JPanel;

public abstract class SwingSpielView<
        C extends SpielController<?, C, V>,
        V extends SpielView<C, V>
> extends SpielView<C, V> {
    protected JPanel mainPanel;

    public SwingSpielView(C spielController) {
        super(spielController);
        mainPanel = new JPanel();
    }
    
    @Override
	public Object getAsObject() {
		return mainPanel;
	}
}


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\util\GsonIO.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.util;

import java.io.IOException;
import java.lang.reflect.Type;
import java.nio.charset.StandardCharsets;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.StandardOpenOption;

import com.google.gson.Gson;

public class GsonIO {
    public static <T> T load(Path path, Type type) throws IOException {
        Gson gson = new Gson();
		if(!Files.exists(path))
			Files.createFile(path);
		String jsonString = new String(Files.readAllBytes(path));
		return gson.fromJson(jsonString, type);  
    }

    public static <T> void save(T t, Type type, Path path) throws IOException {
		Gson gson = new Gson();
		String jsonString = gson.toJson(t, type);
		Files.writeString(path, jsonString, 
			StandardCharsets.UTF_8, 
			StandardOpenOption.CREATE, 
			StandardOpenOption.TRUNCATE_EXISTING
		);
	}
}


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\util\Propagate.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.util;

import java.util.function.Consumer;

public final class Propagate {
    public static volatile Consumer<Throwable> exceptHandler = t -> {
        t.printStackTrace();
    };

    private Propagate() {}

    public static void propagate(Throwable t) {
        Consumer<Throwable> handler = exceptHandler;
        if (handler != null) handler.accept(t);
    }

    @FunctionalInterface
    public interface ThrowingRunnable {
        void run() throws Exception;
    }

    public static void propagate(ThrowingRunnable runnable) {
        try {
            runnable.run();
        } catch (Throwable t) {
            Consumer<Throwable> handler = exceptHandler;
            if (handler != null) handler.accept(t);
        }
    }

    @FunctionalInterface
    public interface ThrowingSupplier<T> {
        T get() throws Exception;
    }

    public static <T> T propagate(ThrowingSupplier<T> supplier) {
        try {
            return supplier.get();
        } catch (Throwable t) {
            Consumer<Throwable> handler = exceptHandler;
            if (handler != null) handler.accept(t);
            return null;
        }
    }
}


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\view\EinstellungenListener.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.view;

public interface EinstellungenListener {
    void onEinstellungenSave();
}


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\view\EinstellungsView.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.view;


/**
 * @author mhbau
 * @version 1.0
 * @created 08-Dez-2025 15:09:38
 */
public interface EinstellungsView {

	public int getAnzahlRunden();

	public String getSchwierigkeit();

	public String getTheme();

	/**
	 * 
	 * @param anzahlRunden
	 */
	public void setAnzahlRunden(int anzahlRunden);

	/**
	 * 
	 * @param schwierigkeit
	 */
	public void setSchwierigkeit(String schwierigkeit);

	void setSchwierigkeiten(String[] schwierigkeiten);

	/**
	 * 
	 * @param theme
	 */
	public void setTheme(String theme);

	void setThemes(String[] themes);

	void setEinstellungsListener(EinstellungenListener l);
}


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\view\EinstellungsViewImpl.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.view;

import java.awt.GridBagConstraints;
import java.awt.GridBagLayout;

import javax.swing.JButton;
import javax.swing.JComboBox;
import javax.swing.JComponent;
import javax.swing.JLabel;
import javax.swing.JPanel;
import javax.swing.JTextField;
import javax.swing.SwingConstants;
import javax.swing.UIManager;
import javax.swing.border.EmptyBorder;
import java.awt.Insets;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;

import com.formdev.flatlaf.FlatClientProperties;

/**
 * @author Benutzbiber
 * @version 1.0
 * @created 08-Dez-2025 15:09:38
 */
public class EinstellungsViewImpl extends JPanel implements EinstellungsView {

	private JTextField anzahlRundenField;
	private JComboBox<String> schwierigkeitCBox;
	private JComboBox<String> themeCBox;
	private EinstellungenListener l;

	public EinstellungsViewImpl() {
        setLayout(new GridBagLayout());
        setBorder(new EmptyBorder(20, 20, 20, 20));

        JPanel formPanel = new JPanel(new GridBagLayout());
        formPanel.setBackground(UIManager.getColor("Panel.background"));
        formPanel.putClientProperty(FlatClientProperties.STYLE, "" +
                "border: 1,1,1,1, $Component.borderColor, 1, 15;" +
                "background: $Panel.background");

        GridBagConstraints gbc = new GridBagConstraints();
        gbc.insets = new Insets(10, 20, 10, 20);
        gbc.fill = GridBagConstraints.HORIZONTAL;

        JLabel header = new JLabel("Einstellungen");
        header.putClientProperty(FlatClientProperties.STYLE, "font: $h2.font");
        header.setHorizontalAlignment(SwingConstants.CENTER);
        
        gbc.gridx = 0; gbc.gridy = 0;
        gbc.gridwidth = 2;
        gbc.insets = new Insets(20, 20, 30, 20);
        formPanel.add(header, gbc);

        gbc.insets = new Insets(10, 20, 10, 20);
        gbc.gridwidth = 1;
        gbc.weightx = 0.3;

        addLabel(formPanel, "Rundenanzahl:", 1, gbc);
        
        anzahlRundenField = new JTextField("10");
        anzahlRundenField.putClientProperty(FlatClientProperties.PLACEHOLDER_TEXT, "z.B. 10");
        addComponent(formPanel, anzahlRundenField, 1, gbc);

        addLabel(formPanel, "Schwierigkeit:", 2, gbc);

        schwierigkeitCBox = new JComboBox<>(); 
        addComponent(formPanel, schwierigkeitCBox, 2, gbc);

        addLabel(formPanel, "Design:", 3, gbc);
        
        themeCBox = new JComboBox<>();
        addComponent(formPanel, themeCBox, 3, gbc);

		JButton saveButton = new JButton("Speichern");
		saveButton.addActionListener(new ActionListener() {
			@Override
			public void actionPerformed(ActionEvent e) {
				if(l!=null)l.onEinstellungenSave();
			}
		});
		addComponent(formPanel, saveButton, 4, gbc);

        add(formPanel);
    }

    private void addLabel(JPanel panel, String text, int row, GridBagConstraints gbc) {
        JLabel label = new JLabel(text);
        label.putClientProperty(FlatClientProperties.STYLE, "font: bold");
        gbc.gridx = 0;
        gbc.gridy = row;
        panel.add(label, gbc);
    }

    private void addComponent(JPanel panel, JComponent comp, int row, GridBagConstraints gbc) {
        gbc.gridx = 1;
        gbc.gridy = row;
        gbc.weightx = 0.7;
        panel.add(comp, gbc);
    }

	public int getAnzahlRunden(){
		return Integer.parseInt(anzahlRundenField.getText());
	}

	public String getSchwierigkeit(){
		return (String) schwierigkeitCBox.getSelectedItem();
	}

	public String getTheme(){
		return (String) themeCBox.getSelectedItem();
	}

	/**
	 * 
	 * @param anzahlRunden
	 */
	public void setAnzahlRunden(int anzahlRunden){
		anzahlRundenField.setText(String.valueOf(anzahlRunden));
	}

	/**
	 * 
	 * @param schwierigkeit
	 */
	public void setSchwierigkeit(String schwierigkeit){
		schwierigkeitCBox.setSelectedItem(schwierigkeit);
	}

	/**
	 * 
	 * @param theme
	 */
	public void setTheme(String theme){
		themeCBox.setSelectedItem(theme);
	}

	@Override
	public void setEinstellungsListener(EinstellungenListener l) {
		this.l = l;
	}

	@Override
	public void setThemes(String[] themes) {
		for(String theme : themes)
			themeCBox.addItem(theme);
	}

	@Override
	public void setSchwierigkeiten(String[] schwierigkeiten) {
		schwierigkeitCBox.removeAllItems();
		for(String i : schwierigkeiten)
			schwierigkeitCBox.addItem(i);
	}
}//end EinstellungsViewImpl


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\view\HomeView.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.view;

import java.time.LocalDate;
import java.time.LocalTime;

import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model.Tip;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.spiele.Spiel;

/**
 * @author mhbau
 * @version 1.0
 * @created 08-Dez-2025 15:09:38
 */
public interface HomeView {

	/**
	 * 
	 * @param datum
	 */
	public void setDatum(LocalDate datum);

	/**
	 * 
	 * @param tip
	 */
	public void setTipOfTheDay(Tip tip);

	/**
	 * 
	 * @param uhrzeit
	 */
	public void setUhrzeit(LocalTime uhrzeit);


	void setRecentlyPlayedSpiel(Spiel spiel);
}


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\view\HomeViewImpl.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.view;

import com.formdev.flatlaf.FlatClientProperties;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model.Tip;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.spiele.Spiel;

import javax.imageio.ImageIO;
import javax.swing.*;
import javax.swing.border.EmptyBorder;
import java.awt.*;
import java.awt.image.BufferedImage;
import java.io.IOException;
import java.io.InputStream;
import java.time.LocalDate;
import java.time.LocalTime;
import java.time.format.DateTimeFormatter;
import java.time.format.TextStyle;
import java.util.Locale;

/**
 *
 * @author Benutzbiber
 * @version 1.1
 */
public class HomeViewImpl extends JPanel implements HomeView {
    private JLabel datumLabel;
    private JLabel uhrzeitLabel;
    
    private JLabel tipTitle;
    private JTextArea tipContent;
    private JPanel tipCard;

    private JPanel recentCard;
    private JLabel recentTitle;
    private JLabel recentGameName;
    private JLabel recentGameIcon;
    private JTextArea recentGameDesc;

    private final DateTimeFormatter timeFormatter = DateTimeFormatter.ofPattern("HH:mm");
    private final DateTimeFormatter dateFormatter = DateTimeFormatter.ofPattern("dd. MMMM yyyy");

    public HomeViewImpl() {
        setLayout(new BorderLayout());
        setBorder(new EmptyBorder(40, 40, 40, 40));

        JPanel clockPanel = new JPanel();
        clockPanel.setLayout(new BoxLayout(clockPanel, BoxLayout.Y_AXIS));
        clockPanel.setOpaque(false);
        
        uhrzeitLabel = new JLabel("00:00");
        uhrzeitLabel.setAlignmentX(Component.CENTER_ALIGNMENT);
        uhrzeitLabel.putClientProperty(FlatClientProperties.STYLE, "font: $h00.font");
        
        datumLabel = new JLabel("Montag, 01. Jänner 2025");
        datumLabel.setAlignmentX(Component.CENTER_ALIGNMENT);
        datumLabel.putClientProperty(FlatClientProperties.STYLE, "font: $h3.font; foreground: $Label.disabledForeground");

        clockPanel.add(uhrzeitLabel);
        clockPanel.add(Box.createVerticalStrut(5));
        clockPanel.add(datumLabel);
        clockPanel.add(Box.createVerticalStrut(40));

        add(clockPanel, BorderLayout.NORTH);

        JPanel centerWrapper = new JPanel(new GridBagLayout()); 
        centerWrapper.setOpaque(false);

        JPanel stackPanel = new JPanel();
        stackPanel.setLayout(new BoxLayout(stackPanel, BoxLayout.Y_AXIS));
        stackPanel.setOpaque(false);

        tipCard = createStyledCard();
        tipCard.setPreferredSize(new Dimension(450, 180));
        
        tipTitle = new JLabel("Tipp des Tages");
        tipTitle.putClientProperty(FlatClientProperties.STYLE, "font: bold $h3.font; foreground: $Component.accentColor");
        tipTitle.setBorder(BorderFactory.createEmptyBorder(0, 5, 10, 0));

        tipContent = new JTextArea("Lade Tipp...");
        tipContent.setWrapStyleWord(true);
        tipContent.setLineWrap(true);
        tipContent.setEditable(false);
        tipContent.setFocusable(false);
        tipContent.setOpaque(false);

        tipCard.add(tipTitle, BorderLayout.NORTH);
        tipCard.add(tipContent, BorderLayout.CENTER);

        recentCard = createStyledCard();
        recentCard.setPreferredSize(new Dimension(450, 120));
        recentCard.setVisible(false); 

        recentTitle = new JLabel("Zuletzt gespielt");
        recentTitle.putClientProperty(FlatClientProperties.STYLE, "font: bold $h3.font; foreground: $Component.accentColor");
        recentTitle.setBorder(BorderFactory.createEmptyBorder(0, 5, 10, 0));

        JPanel gameInfoPanel = new JPanel(new BorderLayout(15, 0));
        gameInfoPanel.setOpaque(false);

        recentGameIcon = new JLabel();
        recentGameIcon.setPreferredSize(new Dimension(64, 64));
        recentGameIcon.setBorder(BorderFactory.createEmptyBorder(0, 10, 5, 0));

        JPanel iconWrapper = new JPanel(new BorderLayout());
        iconWrapper.setOpaque(false);
        iconWrapper.setBorder(BorderFactory.createEmptyBorder(0, 10, 5, 0));

        iconWrapper.add(recentGameIcon, BorderLayout.CENTER);
        recentGameIcon.setBorder(null);
        iconWrapper.setPreferredSize(new Dimension(64 + 10, 64));
        
        JPanel textPanel = new JPanel(new GridLayout(2, 1));
        textPanel.setOpaque(false);
        
        recentGameName = new JLabel("Spiel Name");
        recentGameName.putClientProperty(FlatClientProperties.STYLE, "font: bold $h4.font");
        
        recentGameDesc = new JTextArea("Beschreibung...");
        recentGameDesc.setWrapStyleWord(true);
        recentGameDesc.setLineWrap(true);
        recentGameDesc.setOpaque(false);
        recentGameDesc.setEditable(false);
        recentGameDesc.setForeground(Color.GRAY);

        textPanel.add(recentGameName);
        textPanel.add(recentGameDesc);

        gameInfoPanel.add(iconWrapper, BorderLayout.WEST);
        gameInfoPanel.add(textPanel, BorderLayout.CENTER);

        recentCard.add(recentTitle, BorderLayout.NORTH);
        recentCard.add(gameInfoPanel, BorderLayout.CENTER);

        stackPanel.add(tipCard);
        stackPanel.add(Box.createVerticalStrut(20));
        stackPanel.add(recentCard);

        centerWrapper.add(stackPanel);
        add(centerWrapper, BorderLayout.CENTER);
    }


    @Override
    public void setDatum(LocalDate datum) {
        String wochentag = datum.getDayOfWeek().getDisplayName(TextStyle.FULL, Locale.GERMAN);
        String dateStr = datum.format(dateFormatter);
        datumLabel.setText(wochentag + ", " + dateStr);
    }

    @Override
    public void setUhrzeit(LocalTime uhrzeit) {
        uhrzeitLabel.setText(uhrzeit.format(timeFormatter));
    }

    @Override
    public void setTipOfTheDay(Tip tip) {
        if (tip != null) {
			tipTitle.setText(tip.title());
            tipContent.setText(tip.text());
        } else {
            tipContent.setText("Keine Tipps verfügbar.");
        }
    }

    @Override
    public void setRecentlyPlayedSpiel(Spiel spiel) {
        if (spiel == null) {
            recentCard.setVisible(false);
            return;
        }

        recentCard.setVisible(true);
        recentGameName.setText(spiel.getName());
        
        String desc = spiel.getDescription();
        if (desc != null && desc.length() > 60) {
            desc = desc.substring(0, 57) + "...";
        }
        recentGameDesc.setText(desc);

        try (InputStream is = spiel.getIcon()) {
            if (is != null) {
                BufferedImage image = ImageIO.read(is);
                if (image != null) {
                    Image scaledImage = SwingUtil.makeRoundedImage(image, 64, 64, 20);
                    recentGameIcon.setIcon(new ImageIcon(scaledImage));
                } else {
                    recentGameIcon.setIcon(null);
                }
            } else {
                recentGameIcon.setIcon(null);
            }
        } catch (IOException e) {
            e.printStackTrace();
            recentGameIcon.setIcon(null);
        }
        
        this.revalidate();
        this.repaint();
    }

    private JPanel createStyledCard() {
        JPanel card = new JPanel(new BorderLayout(0, 0));
        card.setBorder(new EmptyBorder(20, 20, 20, 20));
        card.putClientProperty(FlatClientProperties.STYLE, "" +
                "arc: 20;" +
                "background: $Button.background;" +
                "border: 1,1,1,1, $Component.borderColor, 1, 20");
        return card;
    }
}


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\view\IconLoader.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.view;

import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Path;

import javax.swing.ImageIcon;

public class IconLoader {
    public static final Path iconsPath = Path.of("icons");

    public static ImageIcon load(String name) {
        byte[] data;
        try {
            data = Files.readAllBytes(iconsPath.resolve(name));
            return new ImageIcon(data);
        } catch (IOException e) {
            e.printStackTrace();
        }
        return null;
    }
}


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\view\MainView.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.view;

import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.controller.MainController;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.spiele.Spiel;

/**
 * @author Benutzbiber
 * @version 1.0
 * @created 08-Dez-2025 15:09:39
 */
public interface MainView {

	public void disposeSpiel();

	public EinstellungsView getEinstellungsView();

	public HomeView getHomeView();

	public SpieleView getSpieleView();

	public void setController(MainController controller);

	/**
	 * 
	 * @param callback
	 */
	public void runOnThread(Runnable callback);

	/**
	 * 
	 * @param spielEngineView
	 */
	public void setSpiel(Spiel spiel);

	/**
	 * 
	 * @param theme
	 */
	public void setTheme(String theme);

	/**
	 * 
	 * @param theme
	 */
	public String[] getAvailableThemes();

	/**
	 * @param title
	 * @param content
	 */
	public void showMessage(String title, String content, MessageType type);
}


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\view\MainViewImpl.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.view;

import java.util.Map;
import java.util.concurrent.atomic.AtomicReference;
import java.util.stream.Stream;

import javax.imageio.ImageIO;
import javax.swing.ImageIcon;
import javax.swing.JButton;
import javax.swing.JFrame;
import javax.swing.JLabel;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.JSeparator;
import javax.swing.JTabbedPane;
import javax.swing.LookAndFeel;
import javax.swing.SwingUtilities;
import javax.swing.UIManager;
import javax.swing.UnsupportedLookAndFeelException;
import javax.swing.UIManager.LookAndFeelInfo;
import javax.swing.border.Border;
import javax.swing.border.EmptyBorder;

import com.formdev.flatlaf.FlatClientProperties;
import com.formdev.flatlaf.FlatDarculaLaf;
import com.formdev.flatlaf.FlatDarkLaf;
import com.formdev.flatlaf.FlatLightLaf;
import com.formdev.flatlaf.intellijthemes.FlatAllIJThemes;
import com.formdev.flatlaf.themes.FlatMacDarkLaf;
import com.formdev.flatlaf.themes.FlatMacLightLaf;

import java.awt.BorderLayout;
import java.awt.Color;
import java.awt.Container;
import java.awt.Dimension;
import java.awt.Font;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.io.IOException;
import java.io.InputStream;

import com.formdev.flatlaf.extras.FlatSVGIcon;

import com.formdev.flatlaf.FlatLaf;

import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.controller.MainController;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.spiele.Spiel;

/**
 * @author Benutzbiber
 * @version 1.0
 * @created 08-Dez-2025 15:09:39
 */
public class MainViewImpl extends JFrame implements MainView {

	private EinstellungsViewImpl einstellungsView;
	private HomeViewImpl homeView;
	private SpieleViewImpl spieleView;
	private JTabbedPane tabbedPane;
	private JPanel gamePane;
	private JPanel gameContentPane;
	private JLabel gameTitleLabel;
	private AtomicReference<MainController> controller = new AtomicReference<>(null);

	public MainViewImpl(){
		super("SBT Worttrainer - Skrinjer::Baumgartner::Troppmann");
		setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
		setSize(600, 500);
		setMinimumSize(new Dimension(600, 550));
		try {
			setIconImage(ImageIO.read(this.getClass().getResourceAsStream("/icons/icon.png")));
		} catch (IOException e) {
			e.printStackTrace();
		}
		homeView = new HomeViewImpl();
		spieleView = new SpieleViewImpl(controller);
		einstellungsView = new EinstellungsViewImpl();

		UIManager.installLookAndFeel("FlatLaf Light", FlatLightLaf.class.getName());
        UIManager.installLookAndFeel("FlatLaf Dark", FlatDarkLaf.class.getName());
        
        UIManager.installLookAndFeel("FlatLaf Mac Light", FlatMacLightLaf.class.getName());
        UIManager.installLookAndFeel("FlatLaf Mac Dark", FlatMacDarkLaf.class.getName());

		UIManager.installLookAndFeel("Flat Darcula", FlatDarculaLaf.class.getName());
		
		for (FlatAllIJThemes.FlatIJLookAndFeelInfo themeInfo : FlatAllIJThemes.INFOS) {
        	UIManager.installLookAndFeel(themeInfo.getName(), themeInfo.getClassName());
    	}

		FlatSVGIcon.ColorFilter.getInstance().setMapper(color -> {
			if (color.equals(Color.BLACK)) {
				return UIManager.getColor("Label.foreground");
			}
			return color;
		});

		JPanel headPanel = new JPanel(new BorderLayout());
		headPanel.setBorder(new EmptyBorder(10, 15, 10, 15));

		gameTitleLabel = new JLabel("Laufendes Spiel");
		gameTitleLabel.putClientProperty(FlatClientProperties.STYLE, "font: bold +2");
		headPanel.add(gameTitleLabel, BorderLayout.WEST);

		JButton exitButton = new JButton("Ausstieg");
		exitButton.setIcon(new FlatSVGIcon(SvgIconLoader.exitSVGPath.toString()));

		exitButton.putClientProperty(com.formdev.flatlaf.FlatClientProperties.STYLE, "" +
			"buttonType: toolBarButton;" +
			"hoverBackground: #FF4D4D;" +
			"hoverForeground: #FFFFFF;" +
			"arc: 10");

		exitButton.setFocusable(false);
		exitButton.addActionListener(e -> controller.get().onSpielBeenden());

		headPanel.add(exitButton, BorderLayout.EAST);

		JPanel headerWrapper = new JPanel(new BorderLayout());
		headerWrapper.add(headPanel, BorderLayout.CENTER);
		headerWrapper.add(new JSeparator(), BorderLayout.SOUTH);

		gamePane = new JPanel();
		gamePane.setLayout(new BorderLayout());
		gamePane.add(headerWrapper, BorderLayout.NORTH);

		gameContentPane = new JPanel(new BorderLayout());
		gamePane.add(gameContentPane, BorderLayout.CENTER);

		tabbedPane = new JTabbedPane();

		tabbedPane.addTab("Start", new FlatSVGIcon(SvgIconLoader.homeSVGPath.toString(), 28, 28), homeView);
		tabbedPane.addTab("Spiele", new FlatSVGIcon(SvgIconLoader.spieleSVGPath.toString(), 28, 28), spieleView);
		tabbedPane.addTab("Einstellungen", new FlatSVGIcon(SvgIconLoader.settingsSVGPath.toString(), 28, 28), einstellungsView);
		tabbedPane.setFont(tabbedPane.getFont().deriveFont(16));

		tabbedPane.setSelectedIndex(0);

		setContentPane(tabbedPane);

		setVisible(true);
		requestFocus();
		pack();
	}

	public void setController(MainController controller) {
		this.controller.set(controller);
		einstellungsView.setEinstellungsListener(controller);
	}

	public void disposeSpiel(){
		gameContentPane.removeAll();
		setContentPane(tabbedPane);
	}

	public EinstellungsView getEinstellungsView(){
		return einstellungsView;
	}

	public HomeView getHomeView(){
		return homeView;
	}

	public SpieleView getSpieleView(){
		return spieleView;
	}

	/**
	 * 
	 * @param spielEngineView
	 */
	public void setSpiel(Spiel spiel){
		gameContentPane.add((Container)spiel.newSpielEngineView().getAsObject(), BorderLayout.CENTER);
		gameTitleLabel.setText(spiel.getName());
		setContentPane(gamePane);
		SwingUtilities.updateComponentTreeUI(gamePane);
	}

	/**
	 * 
	 * @param callback
	 */
	public void runOnThread(Runnable callback){
		SwingUtilities.invokeLater(callback);
	}

	@Override
	public void setTheme(String theme) {
		for (UIManager.LookAndFeelInfo info : UIManager.getInstalledLookAndFeels())
			if (info.getName().equals(theme)) {
				try {
					UIManager.setLookAndFeel(info.getClassName());
					//SwingUtilities.updateComponentTreeUI(this);
					FlatLaf.updateUI();
					this.getRootPane().updateUI(); 
				} catch (Exception e) {e.printStackTrace();}
				return;
			}
	}

	@Override
	public String[] getAvailableThemes() {
		return Stream.of(UIManager.getInstalledLookAndFeels())
        .map(UIManager.LookAndFeelInfo::getName)
        .toArray(String[]::new);
	}

	private static final Map<MessageType, Integer> typeMap = Map.of(
		MessageType.INFO, JOptionPane.INFORMATION_MESSAGE,
		MessageType.ERROR, JOptionPane.ERROR_MESSAGE
	);

	@Override
	public void showMessage(String title, String content, MessageType type) {
		JOptionPane.showMessageDialog(this, content, title, typeMap.get(type));
	}
}//end MainViewImpl


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\view\MessageType.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.view;

public enum MessageType {
    INFO, ERROR
}


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\view\SpieleListener.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.view;

public interface SpieleListener {
    void onSpielSelected(String name);
    void onSpielBeenden();
}


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\view\SpielEngineView.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.view;


/**
 * @author mhbau
 * @version 1.0
 * @created 08-Dez-2025 15:09:39
 */
public interface SpielEngineView {

	public Object getAsObject();

}


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\view\SpieleView.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.view;

import java.io.IOException;
import java.util.List;

import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.controller.MainController;
import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.spiele.Spiel;

/**
 * @author mhbau
 * @version 1.0
 * @created 08-Dez-2025 15:09:39
 */
public interface SpieleView {

	/**
	 * 
	 * @param spiele
	 */
	public void setSpiele(List<Spiel> spiele) throws IOException;

}


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\view\SpieleViewImpl.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.view;

import java.awt.BorderLayout;
import java.awt.FlowLayout;
import java.awt.GridLayout;
import java.io.IOException;
import java.util.List;
import java.util.concurrent.atomic.AtomicReference;

import javax.swing.JPanel;
import javax.swing.JScrollPane;

import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.spiele.Spiel;

/**
 * @author mhbau
 * @version 1.0
 */
public class SpieleViewImpl extends JPanel implements SpieleView {
    private AtomicReference<? extends SpieleListener> l;
    private JPanel gridPanel;

    public SpieleViewImpl(AtomicReference<? extends SpieleListener> l) {
        this.l = l;

        setLayout(new BorderLayout());
        
        JPanel container = new JPanel(new FlowLayout(FlowLayout.LEFT, 20, 20));
        
        gridPanel = new JPanel();
        gridPanel.setLayout(new GridLayout(0, 3, 20, 20)); 
        gridPanel.setOpaque(false);
        
        container.add(gridPanel);

        JScrollPane scrollPane = new JScrollPane(container);
        scrollPane.setBorder(null);
        scrollPane.getVerticalScrollBar().setUnitIncrement(16);
        
        add(scrollPane, BorderLayout.CENTER);
    }

    /**
     * @param spiele
     * @throws IOException
     */
    public void setSpiele(List<Spiel> spiele) throws IOException {
        gridPanel.removeAll();
        
        for (Spiel s : spiele) 
            gridPanel.add(new SpielPanel(
                s.getName(), 
                s.getDescription(), 
                s.getIcon(), 
                l
            ));
            
        gridPanel.revalidate();
        gridPanel.repaint();
    }
}


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\view\SpielPanel.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.view;

import java.awt.*;
import java.awt.event.MouseAdapter;
import java.awt.event.MouseEvent;
import java.awt.geom.RoundRectangle2D;
import java.awt.image.BufferedImage;
import java.io.IOException;
import java.io.InputStream;
import java.util.concurrent.atomic.AtomicReference;

import javax.imageio.ImageIO;
import javax.swing.*;
import javax.swing.border.EmptyBorder;

import com.formdev.flatlaf.FlatClientProperties;

/**
 * @author mhbau
 * @version 1.2
 */
public class SpielPanel extends JPanel {
    private final AtomicReference<? extends SpieleListener> listenerRef;
    private static final int CARD_WIDTH = 250;
    private static final int CARD_HEIGHT = 280;
    private static final int IMAGE_SIZE = 120;
    private static final int MAX_DESC_LENGTH = 90;

    /**
     * @param name         The title of the game
     * @param beschreibung The description
     * @param iconStream   The input stream for the game icon
     * @param l            Reference to the listener
     */
    public SpielPanel(String name, String beschreibung, InputStream iconStream, AtomicReference<? extends SpieleListener> l) {
        this.listenerRef = l;

        setLayout(new BorderLayout());
        setPreferredSize(new Dimension(CARD_WIDTH, CARD_HEIGHT));
        setBackground(UIManager.getColor("Panel.background"));
        
        putClientProperty(FlatClientProperties.STYLE, "" +
                "arc: 20;" +
                "border: 1,1,1,1, $Component.borderColor, 1, 20");

        JLabel imageLabel = new JLabel();
        imageLabel.setHorizontalAlignment(SwingConstants.CENTER);
        imageLabel.setIcon(processIcon(iconStream));
        imageLabel.setBorder(new EmptyBorder(15, 10, 5, 10));

        JPanel textPanel = new JPanel();
        textPanel.setLayout(new BoxLayout(textPanel, BoxLayout.Y_AXIS));
        textPanel.setOpaque(false);
        textPanel.setBorder(new EmptyBorder(0, 12, 12, 12));

        JLabel titleLabel = new JLabel(name);
        titleLabel.putClientProperty(FlatClientProperties.STYLE, "font: bold +2");
        titleLabel.setAlignmentX(Component.LEFT_ALIGNMENT);

        String displayDesc = beschreibung;
        boolean isTruncated = false;

        if (beschreibung != null && beschreibung.length() > MAX_DESC_LENGTH) {
            int cutOffIndex = beschreibung.lastIndexOf(" ", MAX_DESC_LENGTH);
            if (cutOffIndex == -1) cutOffIndex = MAX_DESC_LENGTH;
            
            displayDesc = beschreibung.substring(0, cutOffIndex) + "...";
            isTruncated = true;
        }

        JTextArea descArea = new JTextArea(displayDesc);
        descArea.setLineWrap(true);
        descArea.setWrapStyleWord(true);
        descArea.setEditable(false);
        descArea.setFocusable(false);
        descArea.setOpaque(false);
        descArea.setBorder(null);
        descArea.setAlignmentX(Component.LEFT_ALIGNMENT);
        descArea.putClientProperty(FlatClientProperties.STYLE, "foreground: $Label.disabledForeground; font: 90%");
        
        textPanel.add(titleLabel);
        textPanel.add(Box.createVerticalStrut(4));
        textPanel.add(descArea);

        if (isTruncated) {
            textPanel.add(Box.createVerticalStrut(5));
            JLabel readMoreLabel = new JLabel("<html><u>Mehr lesen</u></html>");
            readMoreLabel.setForeground(UIManager.getColor("Component.accentColor"));
            readMoreLabel.setCursor(Cursor.getPredefinedCursor(Cursor.HAND_CURSOR));
            readMoreLabel.setAlignmentX(Component.LEFT_ALIGNMENT);
            readMoreLabel.putClientProperty(FlatClientProperties.STYLE, "font: small");

            readMoreLabel.addMouseListener(new MouseAdapter() {
                @Override
                public void mouseClicked(MouseEvent e) {
                    JOptionPane.showMessageDialog(
                            SwingUtilities.getWindowAncestor(SpielPanel.this), 
                            createHtmlDescription(beschreibung), 
                            name, 
                            JOptionPane.INFORMATION_MESSAGE
                    );
                    e.consume();
                }
            });
            textPanel.add(readMoreLabel);
        }

        add(imageLabel, BorderLayout.NORTH);
        add(textPanel, BorderLayout.CENTER);

        setCursor(Cursor.getPredefinedCursor(Cursor.HAND_CURSOR));

        addMouseListener(new MouseAdapter() {
            @Override
            public void mouseClicked(MouseEvent e) {
                if (!e.isConsumed()) {
                    SpieleListener listener = listenerRef.get();
                    if (listener != null) listener.onSpielSelected(name);
                }
            }

            @Override
            public void mouseEntered(MouseEvent e) {
                setBackground(UIManager.getColor("Button.hoverBackground"));
            }

            @Override
            public void mouseExited(MouseEvent e) {
                setBackground(UIManager.getColor("Panel.background"));
            }
        });
    }

    private String createHtmlDescription(String text) {
        return "<html><body style='width: 300px;'>" + text + "</body></html>";
    }

    private ImageIcon processIcon(InputStream stream) {
        if (stream == null) return null;
        try {
            BufferedImage img = ImageIO.read(stream);
            if (img == null) return null;

            Image scaled = SwingUtil.makeRoundedImage(img, IMAGE_SIZE, IMAGE_SIZE, 20);
            return new ImageIcon(scaled);
        } catch (IOException e) {
            e.printStackTrace();
            return null;
        }
    }
}


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\view\StatistikDialog.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.view;

import java.awt.BorderLayout;
import java.awt.Dimension;
import java.awt.GridLayout;
import java.util.Map;

import javax.swing.BoxLayout;
import javax.swing.JButton;
import javax.swing.JDialog;
import javax.swing.JLabel;
import javax.swing.JPanel;
import javax.swing.JScrollPane;
import javax.swing.JTextArea;
import javax.swing.ScrollPaneConstants;
import javax.swing.SwingConstants;
import javax.swing.border.EmptyBorder;

import com.formdev.flatlaf.FlatClientProperties;

import at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.model.Statistik;

/**
 * @author Benutzbiber
 * @version 1.0
 * @created 08-Dez-2025 15:09:39
 */
public class StatistikDialog extends JDialog {
    
    public StatistikDialog(Statistik statistik){
        super();
        setTitle(statistik.getTitle());
        setModal(true);
        setDefaultCloseOperation(JDialog.DISPOSE_ON_CLOSE);
        setResizable(true);

        JPanel contentPanel = new JPanel();
        contentPanel.setLayout(new BorderLayout(10, 20));
        contentPanel.setBorder(new EmptyBorder(20, 20, 20, 20));

        JLabel titleLabel = new JLabel(statistik.getTitle());
        titleLabel.setHorizontalAlignment(SwingConstants.CENTER);
        titleLabel.putClientProperty(FlatClientProperties.STYLE, "font: $h1.font");
        contentPanel.add(titleLabel, BorderLayout.NORTH);

        JPanel centerPanel = new JPanel();
        centerPanel.setLayout(new BoxLayout(centerPanel, BoxLayout.Y_AXIS));

        if (statistik.getFliesstext() != null && !statistik.getFliesstext().isEmpty()) {
            JTextArea descArea = new JTextArea(statistik.getFliesstext());
            descArea.setWrapStyleWord(true);
            descArea.setLineWrap(true);
            descArea.setEditable(false);
            descArea.setFocusable(false);
            descArea.setOpaque(false);
            descArea.setBorder(new EmptyBorder(0, 5, 20, 5));
            
            descArea.setColumns(40); 
            
            descArea.putClientProperty(FlatClientProperties.STYLE, "foreground: $Label.disabledForeground");
            centerPanel.add(descArea);
        }

        if (statistik.getStatFields() != null && !statistik.getStatFields().isEmpty()) {
            JPanel statsGrid = new JPanel();
            statsGrid.setLayout(new GridLayout(0, 2, 20, 10)); 

            for (Map.Entry<String, String> entry : statistik.getStatFields().entrySet()) {
                JLabel keyLabel = new JLabel(entry.getKey() + ":");
                keyLabel.putClientProperty(FlatClientProperties.STYLE, "font: bold");
                
                JLabel valueLabel = new JLabel(entry.getValue()); 
                valueLabel.setHorizontalAlignment(SwingConstants.RIGHT);

                statsGrid.add(keyLabel);
                statsGrid.add(valueLabel);
            }
            centerPanel.add(statsGrid);
        }

        JScrollPane scrollPane = new JScrollPane(centerPanel);
        scrollPane.setBorder(null);
        scrollPane.setHorizontalScrollBarPolicy(ScrollPaneConstants.HORIZONTAL_SCROLLBAR_NEVER);
        scrollPane.getVerticalScrollBar().setUnitIncrement(16);
        
        contentPanel.add(scrollPane, BorderLayout.CENTER);

        JPanel buttonPanel = new JPanel();
        buttonPanel.setBorder(new EmptyBorder(15, 0, 0, 0));

        JButton closeButton = new JButton("Schließen");
        getRootPane().setDefaultButton(closeButton);
        closeButton.addActionListener(e -> dispose());
        closeButton.putClientProperty(FlatClientProperties.STYLE, "font: +1");

        buttonPanel.add(closeButton);
        contentPanel.add(buttonPanel, BorderLayout.SOUTH);

        setContentPane(contentPanel);
        
        pack();
        
        setMinimumSize(new Dimension(400, 300));
        
        Dimension screenSize = java.awt.Toolkit.getDefaultToolkit().getScreenSize();
        if (getHeight() > screenSize.height - 100) {
            setSize(getWidth(), screenSize.height - 100);
        }
        
        setLocationRelativeTo(null);
    }
}


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\view\SvgIconLoader.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.view;

import java.awt.image.BufferedImage;
import java.io.IOException;
import java.io.InputStream;
import java.nio.file.Files;
import java.nio.file.Path;

import javax.swing.ImageIcon;

public class SvgIconLoader { // chat chat chatti wurde hier verwendet (kb auf 50+ documentationen durchlesen)

    public static final Path svgPath = Path.of("icons");
    public static final Path homeSVGPath = svgPath.resolve("home.svg");
    public static final Path settingsSVGPath = svgPath.resolve("settings.svg");
    public static final Path spieleSVGPath = svgPath.resolve("spiele.svg");
    public static final Path exitSVGPath = svgPath.resolve("exit.svg");

    
}


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\app\src\main\java\at\ac\tgm\sskrinjer_mbaumgartner_rtroppmann\worttrainer\view\SwingUtil.java
//==========================================================

package at.ac.tgm.sskrinjer_mbaumgartner_rtroppmann.worttrainer.view;

import java.awt.AlphaComposite;
import java.awt.Color;
import java.awt.Graphics2D;
import java.awt.RenderingHints;
import java.awt.geom.RoundRectangle2D;
import java.awt.image.BufferedImage;

public class SwingUtil {
    public static BufferedImage makeRoundedImage(BufferedImage master, int targetWidth, int targetHeight, int cornerRadius) {
        BufferedImage output = new BufferedImage(targetWidth, targetHeight, BufferedImage.TYPE_INT_ARGB);
        Graphics2D g2 = output.createGraphics();

        g2.setRenderingHint(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_ON);
        g2.setRenderingHint(RenderingHints.KEY_INTERPOLATION, RenderingHints.VALUE_INTERPOLATION_BILINEAR);

        g2.setColor(Color.WHITE);
        g2.fill(new RoundRectangle2D.Float(0, 0, targetWidth, targetHeight, cornerRadius, cornerRadius));

        g2.setComposite(AlphaComposite.SrcAtop);
        g2.drawImage(master, 0, 0, targetWidth, targetHeight, null);

        g2.dispose();
        return output;
    }
}


//==========================================================
// Content from: C:\Users\mhbau\OneDrive\Dokumente\Schule\itp\Worttrainer\settings.gradle
//==========================================================

/*
 * This file was generated by the Gradle 'init' task.
 *
 * The settings file is used to specify which projects to include in your build.
 * For more detailed information on multi-project builds, please refer to https://docs.gradle.org/9.2.1/userguide/multi_project_builds.html in the Gradle documentation.
 */

plugins {
    // Apply the foojay-resolver plugin to allow automatic download of JDKs
    id 'org.gradle.toolchains.foojay-resolver-convention' version '1.0.0'
}

rootProject.name = 'Worttrainer'
include('app')


